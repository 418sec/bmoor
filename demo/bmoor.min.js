;(function(){
/** bmoor v0.0.3 **/
var bMoor={};!function(a){"use strict";function b(a){return a?z(a)?a.split("."):F(a)?a.slice(0):a:[]}function c(a,c,d){var e,f,g,h=d||gb;if(a&&(z(a)||E(a))){a=b(a),f=a.pop();for(var i=0;i<a.length;i++)g=a[i],h[g]||(h[g]={}),h=h[g];e=h[f],h[f]=c}return e}function d(a,c){var d,e,f,g=c||bMoor._root;if(a&&(z(a)||E(a))){a=b(a),e=a.pop();for(var h=0;h<a.length;h++)f=a[h],g[f]||(g[f]={}),g=g[f];d=g[e],delete g[e]}return d}function e(a,c){var d,e=c||bMoor._root;if(a&&(z(a)||E(a))){a=b(a);for(var f=0;f<a.length;f++)d=a[f],e[d]||(e[d]={}),e=e[d];return e}if(C(a))return a;throw"unsupported type"}function f(a,c){var d=c||bMoor._root;if(z(a)||E(a)){a=b(a);for(var e=0;e<a.length;e++){var f=a[e];if(!d[f])return void 0;d=d[f]}return d}if(C(a))return a;throw"unsupported type"}function g(a,b){var c,d,e;if(E(b)&&b.length>0){for(c=0,d=b.length;d>c&&!e;c++)e=f(a,b[c]);return e}return f(a,b)}function h(a,b,c){var d;c?(c.$aliases||(c.$aliases={}),d=c.$aliases):d=hb,d[a]=b}function i(a,b){var c;return b?(b.$aliases||(b.$aliases={}),c=b.$aliases):c=hb,c[a]}function j(a,b){c(a,b,bMoor)}function k(a,b){var c;return void 0===b&&(c=i(F(a)?a.join("."):a))?c:g(a,b)}function l(a,b,d){c(a,b,d)}function m(a,b,c){var d,f,g;if(z(a)&&(a=e(a,c)),g="return new obj(",arguments.length>1)for(d=0,f=b.length;f>d;d++)d&&(g+=","),g+="args["+d+"]";return g+=")",new Function("obj","args",g)(a,b)}function n(a,b){return 1===arguments.length&&(b=a,a={}),M(b,function(b,d){c(d,b,a)}),a}function o(a){return Object.prototype.toString.call(a)}function p(a){var b=function(){};return b.prototype=a,new b}function q(a){return K(arguments,function(b){b!==a&&M(b,function(b,c){a[c]=b})}),a}function r(a,b){return a===b?a:bMoor.isObject(a)?(N(b,function(b,c){a[c]=r(a[c],b)}),a):b}function s(a,b){return N(b,function(b,c){var d=a[c];void 0===d?a[c]=b:bMoor.isArrayLike(b)?(bMoor.isArrayLike(d)||(d=a[c]=[]),t(d,b)):bMoor.isObject(b)?(bMoor.isObject(d)||(d=a[c]={}),s(d,b)):b!==d&&(a[c]=b)}),N(a,function(c,d){void 0===b[d]&&delete a[d]}),a}function t(a,b){var c,d,e,f;for(E(a)&&E(b)&&(a.length=b.length),c=0,d=b.length;d>c;c++)e=b[c],f=a[c],void 0===f?a[c]=e:bMoor.isArrayLike(e)?(bMoor.isArrayLike(f)||(f=a[c]=[]),t(f,e)):bMoor.isObject(e)?(bMoor.isObject(f)||(f=a[c]={}),s(f,e)):e!==f&&(a[c]=e);return a}function u(a,b,c){if(a===b)return b;if(b)if(b.copy)b.copy(a,c);else if(E(a)){b.length=0;for(var d=0,e=a.length;e>d;d++)b.push(u(a[d]))}else L(b,function(a,c){delete b[c]}),L(a,function(a,c){b[c]=a});else b=a,a&&(b=a.clone?a.clone():E(a)?u(a,[],c):u(a,{},c));return b}function v(a,b){var c,d,e,f=typeof a,g=typeof b;if(a===b)return!0;if(a!==a&&b!==b)return!0;if(null===a||void 0===a||null===b||null===b)return!1;if(a.equals)return a.equals(b);if(b.equals)return b.equals(a);if(f===g&&"object"===f)if(E(a)){if(!E(b))return!1;if((c=a.length)===b.length){for(d=0;c>d;d++)if(!v(a[d],b[d]))return!1;return!0}}else if(!E(b)){e={};for(d in a)if(a.hasOwnProperty(d)){if(!v(a[d],b[d]))return!1;e[d]=!0}for(d in b)if(b.hasOwnProperty(d)&&!e&&void 0!==b[d])return!1}return!1}function w(a){C(a)&&a.stack?(console.warn(a),console.debug(a.stack)):(console.warn(a),console.trace())}function x(a){return void 0===a}function y(a){return void 0!==a}function z(a){return"string"==typeof a}function A(a){return"number"==typeof a}function B(a){return"function"==typeof a}function C(a){return a&&"object"==typeof a}function D(a){return"boolean"==typeof a}function E(a){return a?C(a)&&"number"==typeof a.length:!1}function F(a){return"[object Array]"===o(a)}function G(a){return"function"==typeof a&&a.$isQuark}function H(a){var b;if(!C(a))return E(a)?0===a.length:x(a);for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function I(a){return C(a)&&void 0!==a.then}function J(a){return F(a)&&B(a[a.length-1])}function K(a,b,c){var d,e;for(c||(c=a),d=0,e=a.length;e>d;++d)d in a&&b.call(c,a[d],d,a)}function L(a,b,c){var d;c||(c=a);for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)}function M(a,b,c){var d;c||(c=a);for(d in a)a.hasOwnProperty(d)&&"_"!==d.charAt(0)&&b.call(c,a[d],d,a)}function N(a,b,c){var d;c||(c=a);for(d in a)a.hasOwnProperty(d)&&"_"!==d.charAt(0)&&"$"!==d.charAt(0)&&b.call(c,a[d],d,a)}function O(a,b,c){a&&(a.forEach&&a.forEach!==O?a.forEach(b,c):E(a)?K(a,b,c):B(a)?M(a,b,c):L(a,b,c))}function P(a){var b;return G(a)?a.$promise:(b=new cb,b.resolve(a),b.promise)}function Q(a,d){var e,f=b(a),h=g(f),i=function(){throw"You tried to construct a Quark: "+f.join(".")};return G(h)?h:(d=d||bMoor._root,i.$isQuark=!0,cb&&(e=new cb,i.$promise=e.promise,i.$ready=function(a){e.resolve&&e.resolve(a),f&&c(f,a,d)}),c(f,i,d),i)}function R(a,b,c){var d=g(a,b,c);return d?P(d):Q(a,b).$promise}function S(a,b){var c=a.charAt(0);return"@"===c?i(a.substr(1),b):"-"===c?g(a.substr(1),b):("+"===c&&(a=a.substr(1)),R(a,b))}function T(a,b){var c=[];return K(a,function(a,d){c[d]=z(a)?bMoor.decode(a,b):a}),c}function U(a,b,c){var d;return z(a)?R(a,c):E(a)?(d=new db,K(a,function(e,f){b&&z(e)&&(e=R(e,c)),I(e)?(e.then(function(b){a[f]=b}),d.add(e)):a[f]=e}),d.run(),d.promise.then(function(){return a})):void 0}function V(a,b,c){var d;if(B(a))d=a,a=[];else{if(!J(a))throw"inject needs arr to be either Injectable or Function";d=a[a.length-1]}return c||(c=bMoor),U(T(a,b),!1,b).then(function(a){return d.apply(c,a)})}function W(a){var b=a,c=document.createElement("a");return eb&&(c.setAttribute("href",b),b=c.href),c.setAttribute("href",b),{href:c.href,protocol:c.protocol?c.protocol.replace(/:$/,""):"",host:c.host,search:c.search?c.search.replace(/^\?/,""):"",hash:c.hash?c.hash.replace(/^#/,""):"",hostname:c.hostname,port:c.port,pathname:"/"===c.pathname.charAt(0)?c.pathname:"/"+c.pathname}}function X(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function Y(a,b,c){if(a.indexOf)return a.indexOf(b,c);var d=parseInt(a.length,0);for(c=+c||0,1/0===Math.abs(c)&&(c=0),0>c&&(c+=d,0>c&&(c=0));d>c;c++)if(a[c]===b)return c;return-1}function Z(a,b,c){var d=Y(a,b,c);return d>-1?[a.splice(d,1)]:[]}function $(a,b,c){var d,e,f=Y(a,b,c);return f>-1?(e=a.splice(f,1),d=$(a,b,f),d.unshift(e),d):[]}function _(a,b,c){if(a.filter)return a.filter(b,c);var d,e,f=Object(this),g=parseInt(f.length,10),h=[];if(!B(b))throw"func needs to be a function";for(d=0;g>d;d++)d in f&&(e=f[d],b.call(c,e,d,f)&&h.push(e));return h}function ab(a,b,c){var d,e=[],f=[],g=[],h=[];for(a=a.slice(0),b=b.slice(0),a.sort(c),b.sort(c);a.length>0&&b.length>0;)d=c(a[0],b[0]),0>d?e.push(a.shift()):d>0?f.push(b.shift()):(g.push(a.shift()),h.push(b.shift()));for(;a.length;)e.push(a.shift());for(;b.length;)f.push(b.shift());return{left:e,intersection:{left:g,right:h},right:f}}function bb(a){this.defer=a}function cb(a){this.handler=a||this.defaultHandler,this.callbacks=[],this.value=null,this.promise=new bb(this)}function db(){this.count=0,this.loaded=!1,this.errors=[],this.defer=new cb,this.promise=this.defer.promise}var eb,fb,gb=bMoor._root={},hb={};gb.bmoor={},a.navigator?(a.bMoor=bMoor,eb=parseInt((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1],10),isNaN(eb)&&(eb=parseInt((/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1],10)),fb={isNode:!1,msie:eb}):(module.exports=bMoor,fb={isNode:!0}),h("undefined",void 0),c("bmoor.defer.Promise",bb),q(bb.prototype,{then:function(a,b){var c,d,e=this,f=this.defer,g=this.sub=this.defer.sub();return c=function(b){try{g.resolve((a||f.defaultSuccess)(b)),e.sub=null}catch(c){e.sub=null,g.reject(c),f.handler(c)}},d=function(a){try{g.resolve((b||f.defaultFailure)(a)),e.sub=null}catch(c){e.sub=null,g.reject(c),f.handler(c)}},f.register(c,d),g.promise},"catch":function(a){return this.then(null,a)},reject:function(a){if(!this.sub)throw"must reject from inside a then";this.sub.reject(a)},done:function(a){return this.then(a),this},fail:function(a){return this.then(null,a),this},"finally":function(a){function b(a,b){var c=new cb;return b?c.resolve(a):c.reject(a),c.promise}function c(c,e){var f=null;try{f=(a||d.defaultSuccess)()}catch(g){return b(g,!1)}return f&&bMoor.isFunction(f.then)?f.then(function(){return b(c,e)},function(a){return b(a,!1)}):b(c,e)}var d=this;return this.then(function(a){return c(a,!0)},function(a){return c(a,!1)})},always:function(a){return this["finally"](a),this}}),c("bmoor.defer.Basic",cb),function(){function a(a){return a&&a.then?a:{then:function(b){bMoor.isArrayLike(a)&&a.$inject?b.apply(void 0,a):b(a)}}}function b(a){return{then:function(b,c){c(a)}}}q(cb.prototype,{defaultHandler:function(a){bMoor.error.report(a)},defaultSuccess:function(a){return a},defaultFailure:function(a){throw a},register:function(a,b){this.value?this.value.then(a,b):this.callbacks.push([a,b])},resolve:function(b){var c,d,e,f;if(this.callbacks)for(c=this.callbacks,this.callbacks=null,this.value=a(b),e=0,f=c.length;f>e;e++)d=c[e],this.value.then(d[0],d[1])},reject:function(a){this.resolve(b(a))},sub:function(){return new cb(this.handler)}})}(),c("bmoor.defer.Group",db),function(){function a(a){0===a.count&&a.loaded&&(a.errors.length?a.defer.reject(a.errors):a.defer.resolve(!0))}function b(b){b.count--,a(b)}q(db.prototype,{add:function(a){var c=this;this.count++,a.then(function(){b(c)},function(a){c.errors.push(a),b(c)})},run:function(){this.loaded=!0,a(this)}})}(),c("bmoor.defer.all",function(){var a,b=new db;return a=A(arguments[0].length)?arguments[0]:arguments,bMoor.forEach(a,function(a){b.add(a)}),b.run(),b.promise}),q(bMoor,{parseNS:b,dwrap:P,set:c,get:e,del:d,exists:g,register:h,check:i,find:k,install:l,makeQuark:Q,ensure:R,decode:S,request:U,translate:T,inject:V,plugin:j,loop:K,each:L,iterate:M,forEach:O,isBoolean:D,isDefined:y,isUndefined:x,isArray:F,isArrayLike:E,isObject:C,isFunction:B,isNumber:A,isString:z,isInjectable:J,isEmpty:H,isQuark:G,instantiate:m,map:n,object:{safe:N,mask:p,extend:q,copy:u,equals:v,merge:r,override:s},string:{trim:X},array:{compare:ab,indexOf:Y,remove:Z,removeAll:$,filter:_,override:t},error:{report:w},url:{resolve:W}})}(this),bMoor.inject(["bmoor.defer.Basic",function(a){"use strict";var b,c=bMoor.makeQuark("bmoor.build.Compiler"),d=function(){this.preProcess=[],this.postProcess=[],this.clean=!0},e={};d.make=function(b,c,d){var e,f=b.name,g=b.namespace,h=new a,i=h.promise;if(bMoor.isObject(d))return d.abstract?e=function(){throw g+" is abstracted, either extend or use only static members"}:d.construct?e=d.construct:(e=function(){console.log("generic")},e.$generic=!0),d.id=f,d.name=g.pop(),d.mount=bMoor.get(g),d.namespace=g,d.whenDefined=c.$promise,this.clean||(this.preProcess.sort(function(a,b){return b.rank-a.rank}),this.postProcess.sort(function(a,b){return b.rank-a.rank}),this.clean=!0),h.resolve(),bMoor.loop(this.preProcess,function(a){i=i.then(function(){return bMoor.inject(a.module,d,e)})}),i.then(function(){return e.$onMake&&e.$onMake(d),e});throw"Constructor has no idea how to handle as definition of "+d},d.prototype.addModule=function(a,b,c){a=parseInt(a,10),this.clean=!1,arguments.length<3?c=b:bMoor.install(b,c[c.length-1]),a>=0?this.preProcess.push({rank:a,module:c}):this.postProcess.push({rank:a,module:c})},d.prototype.make=function(b,c,f){var g,h,i=this,j=function(c){d.make.call(i,{name:b,namespace:g},h,c).then(function(b){var d=new a,e=d.promise;return d.resolve(),bMoor.loop(i.postProcess,function(a){e=e.then(function(){var d=bMoor.inject(a.module,c,b);return d.then(function(a){a&&(b=a)}),d})}),e.then(function(){return h.$ready(b),b})})};if(bMoor.isString(b))g=bMoor.parseNS(b);else{if(!bMoor.isArray(b))throw JSON.stringify(b)+" > "+JSON.stringify(c)+" > message : you need to define a name and needs to be either a string or an array";g=b,b=b.join(".")}return h=bMoor.makeQuark(g,f),bMoor.isInjectable(c)||!function(){var a=c;c=[function(){return a}]}(),e[b]=c,bMoor.require?bMoor.require.inject(c,f).then(j):bMoor.inject(c,f).then(j),h.$promise},d.prototype.mock=function(b,c,f){var g=this,h=new a,i={$promise:h.promise};return f||(f=bMoor._root),bMoor.inject(e[b],bMoor.object.extend({},f,c),{},!0).then(function(b){return d.make.call(g,{name:"mock",namespace:["mock"]},i,b).then(function(c){var d=new a,e=d.promise;return d.resolve(),bMoor.loop(g.postProcess,function(a){e=e.then(function(){return bMoor.inject(a.module,b,c)})}),e.then(function(){return h.resolve(i),c})})})},d.prototype.define=function(a,b,c){var d=bMoor.makeQuark(a,c);return bMoor.isInjectable(b)?bMoor.inject(b).then(function(a){d.$ready(a)}):d.$ready(b),d.$promise},b=new d,b.$constructor=d,bMoor.plugin("make",function(a,c,d){return b.make(a,c,d)}),bMoor.plugin("mock",function(a,c,d){return b.mock(a,bMoor.map(c),d)}),bMoor.plugin("define",function(a,c,d){return b.define(a,c,d)}),c.$ready(b)}]),bMoor.inject(["bmoor.build.Compiler",function(a){"use strict";function b(a,b,c){var d=b[a];bMoor.isFunction(c)?b[a]=function(){var a,b=this._wrapped;return this.$wrapped=d,a=c.apply(this,arguments),this.$wrapped=b,a}:bMoor.isString(c)&&(b[a]+=" "+c)}a.addModule(9,"bmoor.build.ModDecorate",["-decorators",function(a){var c=this.prototype;if(a){if(!bMoor.isArray(a))throw"the decoration list must be an array";bMoor.loop(a,function(a){var d,e;d=bMoor.isFunction(a)?new a(c):a;for(e in d)c[e]?b(e,c,d[e]):c[e]=d[e]})}}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){"use strict";a.addModule(5,"bmoor.build.ModFactory",["-factory",function(a){var b=this;a&&bMoor.iterate(a,function(a,c){b["$"+c]=function(){return a.apply(b,arguments)}})}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){"use strict";a.addModule(1,"bmoor.build.ModFinalize",["-onMake","-parent",function(a,b){a?this.$onMake=a:b&&(this.$onMake=b.$onMake)}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){"use strict";a.addModule(90,"bmoor.build.ModInherit",["-id","-namespace","-name","-mount","-parent",function(a,b,c,d,e){var f,g,h;e&&(f=this,g=bMoor.isFunction(e)?e.prototype:e,h=function(){this.constructor=f},h.prototype=g,this.prototype=new h,delete this.$generic),this.prototype.$static=this,this.prototype.__class=a,this.prototype.__namespace=b,this.prototype.__name=c,this.prototype.__mount=d}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){"use strict";a.addModule(-1,"bmoor.build.ModInstances",["-instances",function(a){var b=this;a&&bMoor.iterate(a,function(a,c){b["$"+c]=bMoor.instantiate(b,a)})}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){"use strict";a.addModule(11,"bmoor.build.ModMixins",["-mixins",function(a){a&&(a=bMoor.isArray(a)?a.splice(0):[a],a.unshift(this.prototype),bMoor.object.extend.apply(this,a))}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){"use strict";a.addModule(-2,"bmoor.build.ModPlugin",["-plugins",function(a){var b=this;a&&bMoor.loop(a,function(a){var c;c=a.instance?bMoor.isString(a.instance)?b["$"+a.instance]:bMoor.instantiate(b,a.instance):b,bMoor.iterate(a.funcs,function(a,d){bMoor.isString(a)&&(a=b[a]),bMoor.plugin(d,function(){return a.apply(c,arguments)})})})}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){"use strict";a.addModule(10,"bmoor.build.ModProperties",["-properties",function(a){var b=this.prototype;a&&bMoor.each(a,function(a,c){b[c]=a})}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){"use strict";a.addModule(0,"bmoor.build.ModRegister",["-id",function(a){bMoor.register(a,this)}])}]),function(){"use strict"}(),bMoor.inject(["bmoor.build.Compiler",function(a){"use strict";a.addModule(-1,"bmoor.build.ModSingleton",["-singleton",function(a){var b,c=this;return a?(b=bMoor.instantiate(c,[]),b.$constructor=c,b):void 0}])}]),bMoor.inject(["bmoor.build.Compiler",function(a){"use strict";a.addModule(10,"bmoor.build.ModStatics",["-statics",function(a){var b=this;a&&bMoor.iterate(a,function(a,c){b[c]=a})}])}]),bMoor.inject(["bmoor.build.Compiler","-bmoor.comm.Http","bmoor.defer.Basic","bmoor.flow.Interval",function(a,b,c,d){"use strict";function e(a,b){function c(a){return b[a]||f.settings[a]}var e;return bMoor.isString(b)&&(b={url:b}),e=function(){function i(a){var c=a.then(function(a){var b=p?p(a):a,c=b.data,d=b.code;return t&&t.call(o),q&&!q(d,c)?(Array.prototype.unshift.call(m,b),s.apply(o,m)):r?(Array.prototype.unshift.call(m,c),r.apply(o,m)):c},function(a){return t&&t.call(o),Array.prototype.unshift.call(m,a),s.apply(o,m)});return b.cached&&(g[k]=c),c}var j,k,l,m=arguments,n=c("http"),o=b.context||a,p=c("decode"),q=c("validation"),r=c("success"),s=c("failure"),t=c("always");return b.massage&&Array.prototype.push.call(m,b.massage.apply(o,m)),k="function"==typeof b.url?b.url.apply(o,m):b.url,l=b.preload?"function"==typeof b.preload?b.preload():b.preload:bMoor.dwrap(void 0),l.then(function(){var a,c,l;if(b.response)c=function(){var a;return a="function"==typeof b.response?b.response.apply(o,m):b.response,i(a.then?a.then(function(a){return{data:a,code:200}}):bMoor.dwrap({data:a,code:200}))};else{if(b.cached&&g[k])return g[k];if(h[k])return h[k];c=function(){return i(n(bMoor.object.extend({method:b.method||"GET",data:m[m.length-1],url:k,headers:bMoor.object.extend({"Content-Type":"application/json"},f.settings.headers,b.headers)},b.comm||{})))}}return void 0===b.interval||h[k]?a=c():(l=function(){return e.lastRun=(new Date).getTime(),c()},e.setInterval=function(c){var f=(new Date).getTime();a=!e.lastRun||f-c<e.lastRun||e.lastInterval&&e.lastInterval>c?l():k&&b.cached?g[k]:e.lastResponse,e.lastInterval=c,j&&d.clear(j),j=d.set(function(){h[k]=l()},c)},e.stopRefresh=function(){d.clear(j),b.onStopRefresh&&b.onStopRefresh.call(o)},b.interval?e.setInterval(b.interval):a=l()),k&&(h[k]=a,a.then(function(){h[k]=null},function(){h[k]=null})),e.lastResponse=a,a},function(){return Array.prototype.unshift.call(m,{code:0,message:"Preload Error"}),b.failure.apply(o,m)})}}var f,g={},h={};f=function(a){var b=this;bMoor.iterate(a,function(a,c){b.prototype[c]=e(b,a)})},f.clearCache=function(a){delete g[a]},f.settings={http:b,defer:c,validation:function(a,b){return(!a||200===a)&&b},failure:function(a){console.log(a)}},a.addModule(9,"bmoor.build.ModStreams",["-streams",f])}]),bMoor.make("bmoor.defer.Stack",[function(){"use strict";function a(a,b,c){return a.promise.then(function(){return b.apply({},c||[])})}return{construct:function(){this.promise=null},properties:{getPromise:function(){return this.promise},isStacked:function(){return null!==this.promise},begin:function(){this.promise=null},run:function(a){this.promise?this.promise["finally"](a):a()},add:function(b,c){return this.promise?this.promise=a(this,b,c):(this.promise=b.apply({},c),this.promise.then||(this.promise=null)),this.promise}}}}]),bMoor.make("bmoor.flow.Batch",["bmoor.flow.Timeout",function(a){"use strict";return{construct:function(){this.content=null,this.timeoutId=null,this.notices=[]},properties:{wrap:function(a){var b=this;return function(){b.set(a.apply(this,arguments))}},set:function(a){this.registerCall(),this.content=bMoor.object.merge(this.content,a)},notice:function(a){this.notices.push(a)},registerCall:function(){var b=this,c=this.notices;a.clear(this.timeoutId),this.timeoutId=a.set(function(){var a,d,e=b.content;for(b.content=null,a=0,d=c.length;d>a;a++)c[a](e)},30)}}}}]),bMoor.make("bmoor.flow.Interval",[function(){"use strict";return{construct:function(){this.clearAll()},properties:{set:function(a,b){var c,d=this.timeouts[b],e=this._c++;return d||(d=this.timeouts[b]={_c:0},bMoor.testMode||(d._hk=setInterval(function(){bMoor.iterate(d,function(a){a()})},b))),c=d._c++,d[c]=a,this.hash[e]={hk:d._c,val:b},e},flush:function(){bMoor.iterate(this.timeouts,function(a){bMoor.iterate(a,function(a){a()})})},clear:function(a){var b=this.hash[a];b&&(delete this.timeouts[b.val][b.hk],delete this.hash[a])},clearAll:function(){this._c=0,this.timeouts={},this.hash={}}},singleton:!0}}]),bMoor.make("bmoor.flow.Regulator",["bmoor.flow.Timeout",function(a){"use strict";return{construct:function(){this.content=null,this.timeoutId=null,this.notices=[]},properties:{wrap:function(a){var b=this;return function(){b.set(a.apply(this,arguments))}},set:function(a){this.registerCall(),this.content=bMoor.object.merge(this.content,a)},notice:function(a){this.notices.push(a)},registerCall:function(){var b=this,c=this.notices;this.timeoutId||(this.timeoutId=a.set(function(){var a,d,e=b.content;for(b.content=null,this.timeoutId=null,a=0,d=c.length;d>a;a++)c[a](e)},30))}}}}]),bMoor.make("bmoor.flow.Timeout",[function(){"use strict";return{construct:function(){},properties:{set:function(a,b){return setTimeout(a,b)},clear:function(a){clearTimeout(a)}},singleton:!0}}]),bMoor.make("bmoor.data.Collection",["bmoor.data.Model",function(a){"use strict";return{construct:function(a){var b,c=[];this.$override.call(c,this.$inflate.call(c,a));for(b in this)c[b]=this[b];return c},mixins:[a]}}]),bMoor.make("bmoor.data.CollectionObserver",["bmoor.data.MapObserver",function(a){"use strict";return{parent:a,construct:function(){a.apply(this,arguments)},properties:{observe:function(b){var c,d,e;for(this._old=[],this.watches=[],c=0,d=b.length;d>c;c++)e=b[c],bMoor.isString(e)&&(e=new String(e)),this._old[c]=b[c]=e;a.prototype.observe.call(this,b)},watchChanges:function(a){this.watches.push(a)},check:function(){var b=this;this.active&&!this.checking&&(a.prototype.check.call(this),this.checking=!0,this.changes=this.checkChanges(),this._needNotify(this.changes)&&bMoor.loop(this.watches,function(a){a(b.changes)}),this.checking=!1)},checkChanges:function(){var a,b,c,d=this.model,e=this._old,f={},g={},h={};for(a=0,b=e.length;b>a;a++)e[a]._pos=a,h[a]=e[a];for(a=0,b=d.length;b>a;a++)c=d[a],void 0===c._pos?f[a]=d[a]:(delete h[c._pos],c._pos!==a&&(g[a]=c._pos));e.length=d.length;for(a in f)c=f[a],bMoor.isString(c)&&(c=new String(c),f[a]=d[a]=c),e[a]=c;for(a=0,b=d.length;b>a;a++)delete d[a]._pos,e[a]=d[a];return{moves:g,inserts:f,removals:h}},_needNotify:function(a){return!bMoor.isEmpty(a.moves)||!bMoor.isEmpty(a.inserts)||!bMoor.isEmpty(a.removals)}}}}]),bMoor.make("bmoor.data.Map",["bmoor.data.Model",function(a){"use strict";return{mixins:[a],construct:function(a){this.$override(this.$inflate(a))}}}]),bMoor.make("bmoor.data.MapObserver",["bmoor.flow.Interval",function(a){"use strict";var b=0;return{construct:function(c){var d=this,e=a;this.$snapMO=b++,this.checking=!1,this.watching={},this.observe(c),this.start(),e.set(function(){d.check()},30)},properties:{observe:function(a){this.model&&delete this.model.$observers[this.$snapMO],this.model=a,a.$observers||(a.$observers={}),a.$observers[this.$snapMO]=this},watch:function(a,b){var c,d;this.watching[a]||(c=a.split("."),this.watching[a]={path:c,value:this.evaluate(c),calls:[]}),d=this.watching[a],b(d.value,void 0),d.calls.push(b)},evaluate:function(a){var b,c,d=this.model;for(bMoor.isString(a)&&(a=a.split(".")),b=0,c=a.length;c>b&&void 0!==d;b++)d=d[a[b]];return d},check:function(){var a=this;this.active&&!this.checking&&(this.checking=!0,bMoor.iterate(this.watching,function(b){var c,d,e=a.evaluate(b.path);if(e!==b.value){for(c=0,d=b.calls.length;d>c;c++)b.calls[c](e,b.value);b.value=e}}),this.checking=!1)},start:function(){this.active=!0},stop:function(){this.active=!1}}}}]),bMoor.define("bmoor.data.Model",[function(){"use strict";return{$override:function(a){return bMoor.isArrayLike(a)?bMoor.array.override(this,a):bMoor.object.override(this,a),this},$merge:function(a){bMoor.object.merge(this,a)},$validate:function(){return!0},$inflate:function(a){return a},$deflate:function(){return this.$simplify()},$update:function(a){return bMoor.object.merge(this,a)},$simplify:function(){var a=bMoor.isArrayLike()?[]:{};return bMoor.object.safe(this,function(b,c){bMoor.isFunction(b)||(a[c]=b)}),a},$toJson:function(){return JSON.stringify(this.$simplify())}}}]),bMoor.make("bmoor.data.SmartMapObserver",["@undefined","bmoor.data.MapObserver",function(a,b){"use strict";function c(a,b,d){var e;if(bMoor.isString(b))a.updates[b]=bMoor.set(b,d,a.model);else if(bMoor.isObject(b))for(e in b)b.hasOwnProperty(e)&&c(a,e,b[e])}function d(a,b){bMoor.isString(b)&&(a.updates[b]=bMoor.del(b,a.model))}return{parent:b,construct:function(){b.apply(this,arguments)},properties:{observe:function(a){var e=this;this.updates={},b.prototype.observe.call(this,a),a.$set=function(a,b){c(e,a,b)},a.$delete=function(a){d(e,a)}},check:function(){var a=this;bMoor.iterate(this.updates,function(b,c){var d,e,f,g=a.watching[c];if(g)for(f=a.evaluate(c),d=0,e=g.calls.length;e>d;d++)g.calls[d](f,b)}),this.updates={}}}}}]),bMoor.make("bmoor.error.Basic",["@undefined",function(a){"use strict";return{parent:Error,construct:function(b,c,d){var e,f;try{throw new Error}catch(g){f=g}this.name=this.__class,this.error=b,this.fileName=c,this.lineNumber=d,this.problem=a,f.stack&&(e=f.stack.split("\n"),"Error"===e[0]?(e.shift(),e.shift(),e.shift()):(e.pop(),e.shift(),e.shift()),this.problem=e[0],this.stack=e.join("\n")),this.message=b+"\n"+this.stack},properties:{toString:function(){return this.name+": "+this.message}}}}]);
//# sourceMappingURL=bmoor.min.js.map
}());