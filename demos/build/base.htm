<html>
<head>
<script src="../../src/bMoor.js"></script>
<script src="../../spec/config.js"></script>
<script src="../../src/bmoor/build/ModConstruct.js"></script>
<script src="../../src/bmoor/build/ModInherit.js"></script>
<script src="../../src/bmoor/build/ModProperties.js"></script>
<script src="../../src/bmoor/build/Compiler.js"></script>
<script src="../../src/bmoor/build/ModFinalize.js"></script>
<script src="../../src/bmoor/build/ModSingleton.js"></script>
<script src="../../src/bmoor/build/ModFactory.js"></script>
<script src="../../src/bmoor/build/ModDecorate.js"></script>

<script src="../../src/bmoor/defer/Promise.js"></script>
<script src="../../src/bmoor/defer/Basic.js"></script>
<script src="../../src/bmoor/defer/Group.js"></script>

<script src="../../src/bmoor/core/Decorator.js"></script>
</head>
<body>

<script>
// Basic declaration	
var obj = bMoor.define({
	name : 'foo.Hello',
	properties : {
		hello : function(){ 
			console.log('world'); 
		}
	}
});

( new obj() ).hello();

// Define a singleton
bMoor.define({
	name : 'foo.Woot',
	singleton : true,
	properties : {
		say : function( something ){ 
			console.log( something ); 
		}
	}
});

foo.$woot.say( 'hello to my little friend' );

// Define a factory
bMoor.define({
	name : 'foo.Dog',
	factory : true,
	construct : function( whatToSay ){
		this.something = whatToSay;
	},
	properties : {
		speak : function(){ 
			console.log( this.something ); 
		}
	}
});

obj = foo.Dog.$make('woof');
obj.speak();

// Decoration
bMoor.define({
	name : 'foo.Decorator1',
	parent : 'bmoor.core.Decorator',
	properties : {
		speak : function(){
			this.$wrapped();
			console.log('now roll over');
		}
	} 
});

obj = bMoor.define({
	name : 'foo.Pheonix',
	parent : 'foo.Dog',
	decorators : [
		'foo.Decorator1'
	]
});

( new obj('woofie woof') ).speak();

// --- other craziness
bMoor.define({
	name : 'foo.Bar',
	properties : {
		unos : function( eh ){ console.log('woot '+this.dos+(eh||'')); },
		dos : 2,
		tres : 'three'
	}
}).$defer.promise.then(function(obj){
	console.log( obj );
	var t = new obj();

	console.log( 'foo.Bar', t );
	
	t.unos();
});

bMoor.define({
	name : 'foo.Bar2',
	singleton : true,
	factory : 'fac',
	parent : 'foo.Bar',
	properties : {
		dos : '--2--'
	}
}).$defer.promise.then(function(obj){ 
	var t = new obj();

	console.log( 'foo.Bar2', t );

	t.unos();
});

bMoor.define({
	name : 'Decorator1',
	parent : 'bmoor.core.Decorator',
	properties : {
		unos : function(){
			console.log('wrapped content:');
			this.$wrapped();
		}
	} 
});

bMoor.define({
	name : 'foo.Bar3',
	parent : 'foo.Bar2',
	decorators : [
		'Decorator1'
	]
});

console.log( foo.$bar2 );

foo.Bar2.$instance.unos('3');
foo.$bar2.unos('3.1');
foo.Bar2.$make();

var t = new foo.Bar3();
t.unos();
</script>

</body>
</html>