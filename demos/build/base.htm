<html>
<head>
<script src="../../src/bMoor.js"></script>
<script src="../../spec/config.js"></script>
<script src="../../src/bmoor/build/ModConstruct.js"></script>
<script src="../../src/bmoor/build/ModInherit.js"></script>
<script src="../../src/bmoor/build/ModProperties.js"></script>
<script src="../../src/bmoor/build/Compiler.js"></script>
<script src="../../src/bmoor/build/ModFinalize.js"></script>
<script src="../../src/bmoor/build/ModSingleton.js"></script>
<script src="../../src/bmoor/build/ModFactory.js"></script>
<script src="../../src/bmoor/build/ModDecorate.js"></script>
<script src="../../src/bmoor/build/ModRequire.js"></script>
<script src="../../src/bmoor/build/ModTraits.js"></script>

<script src="../../src/bmoor/defer/Promise.js"></script>
<script src="../../src/bmoor/defer/Basic.js"></script>
<script src="../../src/bmoor/defer/Group.js"></script>

<script src="../../src/bmoor/core/Decorator.js"></script>
<script src="../../src/bmoor/core/Trait.js"></script>
</head>
<body>

<script>
	bMoor.define( 'foo.Bar', {
		properties : {
			unos : function( eh ){ console.log('woot|'+this.dos+'|'+(eh||'')+'|'); },
			dos : 2,
			tres : 'three'
		}
	}).then(function(obj){
		console.log( obj );
		var t = new obj();

		console.log( 'foo.Bar', t );
		
		t.unos();
	});

	bMoor.define( 'mock.Bar', {
		properties : {
			unos : function( eh ){ console.log('woot|mockery'); },
			dos : 2,
			tres : 'three'
		}
	});

	bMoor.define('foo.Bar2', 
		['foo.Bar',function( Bar ){
			return {
				parent : Bar,
				singleton : true,
				factory : 'fac',
				properties : {
					dos : '--2--'
				}
			};
		}]
	).then(function(obj){ 
		var t = new obj();

		console.log( 'foo.Bar2', t );

		t.unos();
	});

	bMoor.define( 'Decorator1', 
		['bmoor.core.Decorator', function( Decorator ){
			return {
				parent : Decorator,
				properties : {
					unos : function(){
						console.log('wrapped content:');
						this.$wrapped();
					}
				}
			};
		}]
	);

	bMoor.define( 'foo.Bar3',
		['foo.Bar2','bmoor.core.Decorator',function( Bar2, Decorator ){
			return {
				parent : Bar2,
				decorators : [
					Decorator
				]
			};
		}]
	);

	console.log( 'foo.Bar2', foo.Bar2, foo.$bar2 );

	foo.Bar2.$instance.unos('3');
	foo.$bar2.unos('3.1');
	foo.Bar2.$make();

	var t = new foo.Bar3();
	t.unos('hey now');

	bMoor.define( 'Trait1', 
		['bmoor.core.Trait',function( Trait ){
			return {
				parent : Trait,
				properties : {
					unos : function(){
						console.log( '__---__');
					},
					hello : function(){
						console.log('world');
					}
				}
			};
		}]
	);

	console.log(bmoor.core.Trait);
	console.log(Trait1);

	bMoor.define( 'foo.Bar4', 
		['foo.Bar3','Trait1', function( Bar3, Trait1 ){
			return {
				parent : Bar3,
				traits : [
					Trait1
				]
			};
		}]
	);

	t = new foo.Bar4();

	t.unos();
	t.hello();

	bMoor.define( 'foo.hello', 
		[function(){
			return function(){
				return 'hello';
			};
		}]
	);

	console.log( 'say', foo.hello() );

	bMoor.define( 'foo.helloToo', function(){
		return 'hello too';
	});

	console.log( 'and once again', foo.helloToo() );

	bMoor.mock('foo.Bar2', {
		'foo.Bar' : mock.Bar
	}).then(function( fake ){
		var t = new fake();

		console.log( 'fake:Bar2', t );

		t.unos();
	});
</script>

</body>
</html>