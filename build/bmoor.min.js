/*! bmoor 2013-10-26 */
!function(){"use strict";String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})}(this),function(a,b,c){"use strict";function d(a){console&&console.log&&(console.log(a),console.trace())}function e(){}function f(){this.args=arguments}function g(){}var h=b.bMoor||{},i=document.getElementsByTagName("script"),j=i[i.length-1],k={},l={templator:["bmoor","templating","JQote"],templatorTag:"#",jsRoot:h.root||j.hasAttribute("root")?j.getAttribute("root"):j.getAttribute("src").match(/^(.*)\/b[Mm]oor(\.min)?\.js/)[1]};b.bMoor=h;var m={parse:function(a){return a?"string"==typeof a?a.split("."):a.length?a.slice(0):a:[]},get:function(a,c){var d,e,f=b;if(a&&("string"==typeof a||a.length)){a=this.parse(a),c&&(d=a.length-1,e=a[d],a[d]=e.charAt(0).toLowerCase()+e.slice(1));for(var g=0;g<a.length;g++){var h=a[g];f[h]||(f[h]={}),f=f[h]}}return f},exists:function(a,c){var d,e,f=b;if(a){if("string"==typeof a||a.length){a=this.parse(a),c&&(d=a.length-1,e=a[d],a[d]=e.charAt(0).toLowerCase()+e.slice(1));for(var g=0;g<a.length;g++){var h=a[g];if(!f[h])return null;f=f[h]}return f}return a}return null}},n={requests:0,onReady:[]};!function(){var a={},b={};n.parseResource=function(a){var b=a.match(/^(.*)\/(js|src)/);return b?b[1]:a.match(/^[js|src]/)?null:null},n.reset=function(){b={".":{fullName:!1},">":this.parseResource(l.jsRoot),"/":l.jsRoot,jquery:{"/":l.jsRoot+"/jquery",".":{fullName:!0}}}},n.reset(),n.setRoot=function(a){b["/"]=a,b[">"]=this.parseResource(a)},n.setLibrary=function(a,d,e,f){var g=b,h=m.parse(a);for(e||(e={});h.length;){var i=h.shift();g[i]===c&&(g[i]={}),g=g[i]}g["/"]=d,g["."]=e,g["*"]=f===!0,g[">"]=this.parseResource(d)},n.delLibrary=function(a){for(var c=b,d=null,e=null,f=m.parse(a);f.length&&c;){var g=f.shift();c[g]?(d=c,e=g,c=c[e]):c=null}c&&delete d[e]},n.getLibrary=function(a,c){for(var d=b,e=b,f=m.parse(a),g=c?null:f.pop(),h=f.slice(0);f.length;){var i=f[0];if(!d[i])break;d=d[f.shift()],d["/"]&&(e=d,h=f.slice(0))}return e["*"]?{root:e["/"],path:[],name:g,settings:e["."],resource:e[">"]}:{root:e["/"],path:h,name:g,settings:e["."],resource:e[">"]}},n.loadSpace=function(b,f,g,i,j){function k(){j===c&&(j={}),i===c&&(i=[]),g.apply(j,i)}function l(a){var c=m.exists(b);!c||c instanceof e||c.prototype&&c.prototype.__defining?setTimeout(l,10):g?(clearTimeout(a),k()):clearTimeout(a)}var n;if(b=m.parse(b),"function"==typeof f?(j=i,i=g,g=f,f=b):f||(f=b),n=m.exists(b))n instanceof e?l():k();else{var o=this.getLibrary(f),p=o.root+(o.path.length?"/"+o.path.join("/"):"")+"/"+(o.settings.fullName?f.join("."):o.name),q=function(c){var e,f,g,h=a[p];for(e=setTimeout(function(){m.exists(b)||d("loaded file : "+c+"\n but no class : "+b.join("."))},5e3),f=0,g=h.length;g>f;f++)h[f](e);a[p]=!0};a[p]?a[p].push(l):"boolean"==typeof a[p]?l():(a[p]=[l],h.module.Resource.loadScriptSet(p+".js",p+".min.js",q))}},n.done=function(a){0===this.requests?a():this.onReady.push(a)},n.require=function(a,b,c){function d(){var a,c,d,e,f=[];if(n--,0===n){for(l.requests--,n--,c=0,a=q,d=a?a.length:0;d>c;c++)f.push(m.get(a[c]));if(b.apply({},f),0===l.requests){for(;l.onReady.length;)e=l.onReady.shift(),e();l.onReady=[]}}}var e,f,g,i,j,k,l=this,n=1,o=null,p=null,q=null;for(a.substring?(p=q=[a],o={}):a.length?(p=q=a,o={}):(o=a.references?a.references:{},p=a.classes?a.classes:[],q=a.aliases?a.aliases:[]),this.requests++,j=0,i=p,k=i?i.length:0;k>j;j++)f=m.parse(i[j]),n++,this.loadSpace(f,d);for(g in o)f=m.parse(g),n++,this.loadSpace(f,o[g],d);if(a.scripts&&(n++,h.module.Resource.loadScript(a.scripts,d,c?c+"/js/":"js/")),a.styles)for(g in a.styles)n++,e=a.styles[g],"/"!=e.charAt(0)&&(e=c?c+"/css/"+e:"css/"+e),h.module.Resource.loadStyle(e,d);if(a.templates)for(g in a.templates)n++,e=a.templates[g],"/"!=e.charAt(0)&&(e=c?c+"/template/"+e:"template/"+e),h.module.Resource.loadScript(e,d);d()}}(),function(){function c(a,b,c){var d=typeof c,e=b[a];"function"==d?b[a]=function(){var a,b=this._wrapped;return this._wrapped=e,a=c.apply(this,arguments),this._wrapped=b,a}:"string"==d&&(b[a]+=" "+c)}function d(a,c,d){var e=c.parent?m.get(c.parent):null,f=c.namespace?m.parse(c.namespace):[],g=c.namespace?m.get(f):b;if(e&&(e.prototype.__name||(e.prototype.__name=c.parent),a.extend(d,e),e.prototype.__onDefine))if(c.onDefine){var h=c.onDefine;c.onDefine=function(a,b,c,d){e.prototype.__onDefine.call(this,a,b,c,d),h.call(this,a,b,c,d)}}else c.onDefine=e.prototype.__onDefine;d.prototype.__construct=c.construct?c.construct:e?e.prototype.__construct:function(){},d.prototype.__defining=!0,g[c.name]=d,f.push(c.name),d.prototype.__class=f.join("."),d.prototype.__name=f.pop(),c.onDefine&&(d.prototype.__onDefine=c.onDefine),c.aliases&&a.alias(d,c.aliases),a.statics(d,c.statics),c.properties&&a.properties(d,c.properties)}var h=[],i=!1,j=0;g.prototype.define=function(c){function g(){var e,f=m.exists(c.parent);if(f&&f.prototype.__defining)setTimeout(g,10);else if(d(k,c,q),c.onDefine&&(e=c.onDefine.apply(q.prototype,[c,p,c.name,q])),e||(e=p[c.name]),c.onReady&&a(document).ready(function(){n.done(function(){c.onReady(e)})}),delete q.prototype.__defining,j--,0===j)for(;h.length;){var i=h.pop();i(a,b)}}var k=this,l=c.require,o=n.getLibrary(c.namespace,!0).resource,p=m.get(m.parse(c.namespace)),q=function(){i||this.__construct.apply(this,arguments[0]instanceof f?arguments[0].args:arguments)};if(j++,!c.name)throw"Need name for class";p[c.name]=new e,l?l.length&&(l={classes:l}):l={},c.parent&&(l.classes?l.classes.push(c.parent):l.classes=[c.parent]),c.aliases&&(l.aliases=c.aliases),n.require(l,g,o)},g.prototype.singleton=function(a){var b=a.onDefine?a.onDefine:function(){};a.onDefine=function(a,c,d,e){var f,g=new e,h=d.charAt(0).toLowerCase()+d.slice(1);return c[h]=g,b.apply(this,[a,c,d,e,g]),a.module&&(f=a.module,f=f.charAt(0).toUpperCase()+f.slice(1).toLowerCase(),k[f]=g),g},this.define(a)},g.prototype.factory=function(a){var b=a.onDefine?a.onDefine:function(){};a.onDefine=function(a,c,d,e){var f={},g=function(){return Array.prototype.push.call(arguments,e),a.factory.apply(f,arguments)};c[d.charAt(0).toLowerCase()+d.slice(1)]=g,b.apply(this,arguments)},this.define(a)},g.prototype.decorator=function(a){var b,d;a.properties||(a.properties={}),b=a.properties._decorate,d=a.construct,delete a.properties._decorate,delete a.construct,a.properties._decorate=function(a,e){var f;d&&(e?c("__construct",a,function(){this._wrapped&&this._wrapped.apply(this,arguments),d.apply(this,arguments)}):d.apply(a));for(f in this)"__construct"!==f&&"_decorate"!==f&&(a[f]?c(f,a,this[f]):a[f]=this[f]);return b&&b.call(a),a},this.singleton(a)},g.prototype.mutate=function(a,b){var c,d,e=a.onDefine?a.onDefine:function(){};if(a.decorators){for(d="string"==typeof a.decorators?d.split(","):a.decorators,a.require?a.require.length&&(a.require={classes:a.require}):a.require={},a.require.classes||(a.require.classes=[]),c=0;c<d.length;c++)a.require.classes.push(d[c]);a.onDefine=function(a,b,c,f){var g,h,i;for(e.apply(this,[a,b,c,f]),g=0,i=d,h=i.length;h>g;g++)m.get(i[g],!0)._decorate(this,!0);for(g in a.noOverride)this[g]=a.noOverride[g]}}b?this.singleton(a):this.define(a)},g.prototype.properties=function(a,b){for(var c in b)a.prototype[c]=b[c]},g.prototype.statics=function(b,c){b.prototype.__static?(b.prototype.__static={},a.extend(b.prototype.__static,c)):b.prototype.__static=c?c:{}},g.prototype.alias=function(a,b){for(var c in b){var d=b[c];a.prototype["__"+d]=m.get(c).prototype}},g.prototype.extend=function(a,b){i=!0,a.prototype=new b,a.prototype.constructor=a,a.prototype[b.prototype.__class]=b.prototype,i=!1},g.prototype.loaded=function(c){j?h.push(c):c(a,b)}}(),h.module=k,h.setTemplate=function(a,b){this.templates[a]=b},h.templates={},h.require=function(){n.require.apply(n,arguments)},h.get=function(a,b){return m.exists(a,b)},h.settings=l,h.autoload=n,h.constructor=new g}(jQuery,this),function(a,b){"use strict";var c={};bMoor.constructor.singleton({name:"Resource",namespace:["bmoor","lib"],module:"Resource",onReady:function(a){var b,c=document.getElementsByTagName("script");bMoor.setTemplate=function(b,c){a.setTemplate(b,c)};for(b in bMoor.templates)a.setTemplate(b,bMoor.templates[b]);for(var d=0,e=c.length;e>d;d++){var f=c[d];f.id&&(f.src&&(a.__static.loadedScripts[f.src]=f.id),"text/html"==f.getAttribute("type")&&a.setTemplate(f.id,f.innerHTML))}},statics:{loadedScripts:{}},properties:{loadScriptSet:function(){var a=Array.prototype.slice.call(arguments,0),b=a.pop(),c=a.shift(),d=c,e=function(){$.getScript(c).done(b).fail(function(b,f,g){a.length?(c=a.shift(),e()):error("failed to load file : "+d+"\nError : "+g)})};e()},loadScript:function(a,b,c){var d,e=this;"string"==typeof a&&(a=[a]),d=(c||"")+a.shift(),$.getScript(d).done(function(){a.length?e.loadScript(a,b,c):b()}).fail(function(a,b,c){error("failed to load file : "+d+"\nError : "+c)})},loadStyle:function(a,b){var c,d,e,f=null;d=document.createElement("link"),d.setAttribute("href",a),d.setAttribute("rel","stylesheet"),d.setAttribute("type","text/css"),d.sheet?(e="sheet",c="cssRules",f=setInterval(function(){try{d[e]&&d[e][c]&&d[e][c].length&&(clearInterval(f),b())}catch(a){}},10)):$(d).bind("load",b),$("head").append(d)},loadImage:function(a,b){var c=new Image;"#"==a[0]&&(a=$(a)[0].src),c.onload=b,c.src=a},loadTemplate:function(a,d,e){var f,g=null,h=bMoor.templates;if(e===b&&"string"!=typeof d&&(e=d,d=null),"#"===a[0]&&(a=a.substring(1)),!h[a])if(c[d]){var i=loadedScript[d];h[i]?h[a]=h[i]:this.setTemplate(a,document.getElementById(i).innerHTML)}else if(null!==(f=document.getElementById(a)))this.setTemplate(a,f.innerHTML);else{if(null===d)throw"loadTemplate : "+a+" requested, and not found, while src is null";g=this,$.ajax(d,{success:function(b){g.setTemplate(b),e(h[a])}})}if(null===g){if(!e)return h[a];e(h[a])}return null},parseTemplate:function(a){var b=null;switch(typeof a){case"string":b=a.replace(/\s*<!\[CDATA\[\s*|\s*\]\]>\s*|[\r\n\t]/g,"");break;case"function":b=a.isTemplate?a:a.toString().split(/\n/).slice(1,-1).join("\n")}return b},setTemplate:function(a,b){bMoor.templates[a]=this.parseTemplate(b)}}},!0)}(this),function(){bMoor.constructor.singleton({name:"Bouncer",namespace:["bmoor","lib"],module:"Schedule",construct:function(){this._stack=[],this._done=[],this._pauseAfter=null,this._lock=!1},properties:{runPause:30,runWindow:300,_setTime:function(){this._pauseAfter=(new Date).getTime()+this.runWindow},add:function(a){this._stack.push(a)},done:function(a){this._done.push(a)},_run:function(){if(this._lock=!1,this._stack.length)this.run();else if(this._done.length){for(;this._done.length;)this.add(this._done.shift());this.run()}else this._pauseAfter=null},run:function(){var a,b=this;this._stack.length&&!this._lock?(this._lock=!0,a=this._stack.shift(),0===this.runWindow?(a(),this._run()):(null===this._pauseAfter&&this._setTime(),a(),(new Date).getTime()>this._pauseAfter?setTimeout(function(){b._pauseAfter=null,b._run()},this.runPause):this._run())):this._run()}}})}(jQuery,this),function(){bMoor.constructor.singleton({name:"KeyboardTracker",namespace:["bmoor","lib"],onReady:function(a){$(document.body).on("keydown",function(b){a.activeKeys[b.which]=!0}),$(document.body).on("keyup",function(b){delete a.activeKeys[b.which]})},properties:{activeKeys:{},isDown:function(a){return this.activeKeys[a]}}})}(this),function(){bMoor.constructor.singleton({name:"MouseTracker",namespace:["bmoor","lib"],onReady:function(a){$(document.body).on("mousemove",function(b){a.x=b.pageX,a.y=b.pageY})}})}(this),function(){bMoor.constructor.singleton({name:"WaitFor",namespace:["bmoor","lib"],construct:function(){},require:{references:{"bMoor.module.Resource":["bmoor","lib","Resource"]}},module:"Wait",properties:{_waiting:0,_done:[],_return:function(){var a;for(this._waiting--;this._done.length&&this._waiting<1;)a=this._done.pop(),a()},done:function(a){this._waiting<1?a():this._done.unshift(a)},require:function(a,b){var c=this;return this._waiting++,bMoor.autoload.require(a,function(){b&&b(),c._return()}),this},loadScript:function(a,b){var c=this;return this._waiting++,bMoor.module.Resource.loadScript(a,function(){b&&b(),c._return()}),this},loadStyle:function(a,b){var c=this;return this.waiting++,bMoor.module.Resource.loadStyle(a,function(){b&&b(),c._return()}),this},loadImage:function(a,b){var c=this;return this._waiting++,bMoor.module.Resource.loadImage(a,function(){b&&b(),c._return()}),this},loadTemplate:function(a,b,c){var d=this;return this._waiting++,bMoor.module.Resource.loadTemplate(a,b,function(){c&&c(),d._return()}),this}}})}(jQuery,this);