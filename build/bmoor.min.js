/*! bmoor 2014-09-21 */
!function(){var a={};!function(b){"use strict";function c(a){return a?A(a)?a.split("."):G(a)?a.slice(0):a:[]}function d(a,b,d){var e,f,g,h=d||gb;if(a&&(A(a)||F(a))){a=c(a),f=a.pop();for(var i=0;i<a.length;i++)g=a[i],h[g]||(h[g]={}),h=h[g];e=h[f],h[f]=b}return e}function e(b,d){var e,f,g,h=d||a._root;if(b&&(A(b)||F(b))){b=c(b),f=b.pop();for(var i=0;i<b.length;i++)g=b[i],h[g]||(h[g]={}),h=h[g];e=h[f],delete h[f]}return e}function f(b,d){var e,f=d||a._root;if(b&&(A(b)||F(b))){b=c(b);for(var g=0;g<b.length;g++)e=b[g],f[e]||(f[e]={}),f=f[e];return f}if(D(b))return b;throw"unsupported type"}function g(b,d){var e=d||a._root;if(A(b)||F(b)){b=c(b);for(var f=0;f<b.length;f++){var g=b[f];if(!e[g])return void 0;e=e[g]}return e}if(D(b))return b;throw"unsupported type"}function h(a,b){var c,d,e;if(F(b)&&b.length>0){for(c=0,d=b.length;d>c&&!e;c++)e=g(a,b[c]);return e}return g(a,b)}function i(a,b,c){var d;c?(c.$aliases||(c.$aliases={}),d=c.$aliases):d=hb,d[a]=b}function j(a,b){var c;return b?(b.$aliases||(b.$aliases={}),c=b.$aliases):c=hb,c[a]}function k(b,c){d(b,c,a)}function l(a,b){var c;return void 0===b&&(c=j(G(a)?a.join("."):a))?c:h(a,b)}function m(a,b,c){d(a,b,c)}function n(a,b,c){var d,e,g;if(A(a)&&(a=f(a,c)),g="return new obj(",arguments.length>1)for(d=0,e=b.length;e>d;d++)d&&(g+=","),g+="args["+d+"]";return g+=")",new Function("obj","args",g)(a,b)}function o(a,b){return 1===arguments.length&&(b=a,a={}),N(b,function(b,c){d(c,b,a)}),a}function p(a){return Object.prototype.toString.call(a)}function q(a){var b=function(){};return b.prototype=a,new b}function r(a){return L(arguments,function(b){b!==a&&M(b,function(b,c){a[c]=b})}),a}function s(b,c){return b===c?b:a.isObject(b)?(M(c,function(a,c){b[c]=s(b[c],a)}),b):c}function t(b,c){var d,e,f;for(d in c)c.hasOwnProperty(d)&&(e=c[d],f=b[d],void 0===f?b[d]=e:a.isArrayLike(e)?(a.isArrayLike(f)||(f=b[d]=[]),u(f,e)):a.isObject(e)?(a.isObject(f)||(f=b[d]={}),t(f,e)):e!==f&&(b[d]=e));for(d in b)b.hasOwnProperty(d)&&void 0===c[d]&&delete b[d];return b}function u(b,c){var d,e,f,g;for(F(b)&&F(c)&&(b.length=c.length),d=0,e=c.length;e>d;d++)f=c[d],g=b[d],void 0===g?b[d]=f:a.isArrayLike(f)?(a.isArrayLike(g)||(g=b[d]=[]),u(g,f)):a.isObject(f)?(a.isObject(g)||(g=b[d]={}),t(g,f)):f!==g&&(b[d]=f);return b}function v(a,b,c){if(a===b)return b;if(b)if(b.copy)b.copy(a,c);else if(F(a)){b.length=0;for(var d=0,e=a.length;e>d;d++)b.push(v(a[d]))}else M(b,function(a,c){delete b[c]}),M(a,function(a,c){b[c]=a});else b=a,a&&(b=a.clone?a.clone():F(a)?v(a,[],c):v(a,{},c));return b}function w(a,b){var c,d,e,f=typeof a,g=typeof b;if(a===b)return!0;if(a!==a&&b!==b)return!0;if(null===a||void 0===a||null===b||null===b)return!1;if(a.equals)return a.equals(b);if(b.equals)return b.equals(a);if(f===g&&"object"===f)if(F(a)){if(!F(b))return!1;if((c=a.length)===b.length){for(d=0;c>d;d++)if(!w(a[d],b[d]))return!1;return!0}}else if(!F(b)){e={};for(d in a)if(a.hasOwnProperty(d)){if(!w(a[d],b[d]))return!1;e[d]=!0}for(d in b)if(b.hasOwnProperty(d)&&!e&&void 0!==b[d])return!1}return!1}function x(a){D(a)&&a.stack?(console.warn(a),console.debug(a.stack)):(console.warn(a),console.trace())}function y(a){return void 0===a}function z(a){return void 0!==a}function A(a){return"string"==typeof a}function B(a){return"number"==typeof a}function C(a){return"function"==typeof a}function D(a){return a&&"object"==typeof a}function E(a){return"boolean"==typeof a}function F(a){return a?D(a)&&"number"==typeof a.length:!1}function G(a){return"[object Array]"===p(a)}function H(a){return"function"==typeof a&&a.$isQuark}function I(a){var b;if(!D(a))return F(a)?0===a.length:y(a);for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function J(a){return D(a)&&void 0!==a.then}function K(a){return G(a)&&C(a[a.length-1])}function L(a,b,c){var d,e;for(c||(c=a),d=0,e=a.length;e>d;++d)d in a&&b.call(c,a[d],d,a)}function M(a,b,c){var d;c||(c=a);for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)}function N(a,b,c){var d;c||(c=a);for(d in a)a.hasOwnProperty(d)&&"$"!==d.charAt(0)&&"_"!==d.charAt(0)&&b.call(c,a[d],d,a)}function O(a,b,c){a&&(a.forEach&&a.forEach!==O?a.forEach(b,c):F(a)?L(a,b,c):C(a)?N(a,b,c):M(a,b,c))}function P(a){var b;return H(a)?a.$promise:(b=new cb,b.resolve(a),b.promise)}function Q(b,e){var f,g=c(b),i=h(g),j=function(){throw"You tried to construct a Quark: "+g.join(".")};return H(i)?i:(e=e||a._root,j.$isQuark=!0,cb&&(f=new cb,j.$promise=f.promise,j.$ready=function(a){f.resolve&&f.resolve(a),g&&d(g,a,e)}),d(g,j,e),j)}function R(a,b,c){var d=h(a,b,c);return d?P(d):Q(a,b).$promise}function S(a,b){var c=a.charAt(0);return"@"===c?j(a.substr(1),b):"-"===c?h(a.substr(1),b):("+"===c&&(a=a.substr(1)),R(a,b))}function T(b,c){var d=[];return L(b,function(b,e){d[e]=A(b)?a.decode(b,c):b}),d}function U(a,b,c){var d;return A(a)?R(a,c):F(a)?(d=new db,L(a,function(e,f){b&&A(e)&&(e=R(e,c)),J(e)?(e.then(function(b){a[f]=b}),d.add(e)):a[f]=e}),d.run(),d.promise.then(function(){return a})):void 0}function V(b,c,d){var e;if(C(b))e=b,b=[];else{if(!K(b))throw"inject needs arr to be either Injectable or Function";e=b[b.length-1]}return d||(d=a),U(T(b,c),!1,c).then(function(a){return e.apply(d,a)})}function W(a){var b=a,c=document.createElement("a");return eb&&(c.setAttribute("href",b),b=c.href),c.setAttribute("href",b),{href:c.href,protocol:c.protocol?c.protocol.replace(/:$/,""):"",host:c.host,search:c.search?c.search.replace(/^\?/,""):"",hash:c.hash?c.hash.replace(/^#/,""):"",hostname:c.hostname,port:c.port,pathname:"/"===c.pathname.charAt(0)?c.pathname:"/"+c.pathname}}function X(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function Y(a,b,c){if(a.indexOf)return a.indexOf(b,c);var d=parseInt(a.length,0);for(c=+c||0,1/0===Math.abs(c)&&(c=0),0>c&&(c+=d,0>c&&(c=0));d>c;c++)if(a[c]===b)return c;return-1}function Z(a,b,c){var d=Y(a,b,c);return d>-1?[a.splice(d,1)]:[]}function $(a,b,c){var d,e,f=Y(a,b,c);return f>-1?(e=a.splice(f,1),d=$(a,b,f),d.unshift(e),d):[]}function _(a,b,c){if(a.filter)return a.filter(b,c);var d,e,f=Object(this),g=parseInt(f.length,10),h=[];if(!C(b))throw"func needs to be a function";for(d=0;g>d;d++)d in f&&(e=f[d],b.call(c,e,d,f)&&h.push(e));return h}function ab(a,b,c){var d,e=[],f=[],g=[],h=[];for(a=a.slice(0),b=b.slice(0),a.sort(c),b.sort(c);a.length>0&&b.length>0;)d=c(a[0],b[0]),0>d?e.push(a.shift()):d>0?f.push(b.shift()):(g.push(a.shift()),h.push(b.shift()));for(;a.length;)e.push(a.shift());for(;b.length;)f.push(b.shift());return{left:e,intersection:{left:g,right:h},right:f}}function bb(a){this.defer=a}function cb(a){this.handler=a||this.defaultHandler,this.callbacks=[],this.value=null,this.promise=new bb(this)}function db(){this.count=0,this.loaded=!1,this.errors=[],this.defer=new cb,this.promise=this.defer.promise}var eb,fb,gb=a._root={},hb={};gb.bmoor={},b.navigator?(b.bMoor=a,eb=parseInt((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1],10),isNaN(eb)&&(eb=parseInt((/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1],10)),fb={isNode:!1,msie:eb}):(module.exports=a,fb={isNode:!0}),i("undefined",void 0),d("bmoor.defer.Promise",bb),r(bb.prototype,{then:function(a,b){var c,d,e=this,f=this.defer,g=this.sub=this.defer.sub();return c=function(b){try{g.resolve((a||f.defaultSuccess)(b)),e.sub=null}catch(c){e.sub=null,g.reject(c),f.handler(c)}},d=function(a){try{g.resolve((b||f.defaultFailure)(a)),e.sub=null}catch(c){e.sub=null,g.reject(c),f.handler(c)}},f.register(c,d),g.promise},"catch":function(a){return this.then(null,a)},reject:function(a){if(!this.sub)throw"must reject from inside a then";this.sub.reject(a)},done:function(a){return this.then(a),this},fail:function(a){return this.then(null,a),this},"finally":function(b){function c(a,b){var c=new cb;return b?c.resolve(a):c.reject(a),c.promise}function d(d,f){var g=null;try{g=(b||e.defaultSuccess)()}catch(h){return c(h,!1)}return g&&a.isFunction(g.then)?g.then(function(){return c(d,f)},function(a){return c(a,!1)}):c(d,f)}var e=this;return this.then(function(a){return d(a,!0)},function(a){return d(a,!1)})},always:function(a){return this["finally"](a),this}}),d("bmoor.defer.Basic",cb),function(){function b(b){return b&&b.then?b:{then:function(c){a.isArrayLike(b)&&b.$inject?c.apply(void 0,b):c(b)}}}function c(a){return{then:function(b,c){c(a)}}}r(cb.prototype,{defaultHandler:function(b){a.error.report(b)},defaultSuccess:function(a){return a},defaultFailure:function(a){throw a},register:function(a,b){this.value?this.value.then(a,b):this.callbacks.push([a,b])},resolve:function(a){var c,d,e,f;if(this.callbacks)for(c=this.callbacks,this.callbacks=null,this.value=b(a),e=0,f=c.length;f>e;e++)d=c[e],this.value.then(d[0],d[1])},reject:function(a){this.resolve(c(a))},sub:function(){return new cb(this.handler)}})}(),d("bmoor.defer.Group",db),function(){function a(a){0===a.count&&a.loaded&&(a.errors.length?a.defer.reject(a.errors):a.defer.resolve(!0))}function b(b){b.count--,a(b)}r(db.prototype,{add:function(a){var c=this;this.count++,a.then(function(){b(c)},function(a){c.errors.push(a),b(c)})},run:function(){this.loaded=!0,a(this)}})}(),d("bmoor.defer.all",function(){var b,c=new db;return b=B(arguments[0].length)?arguments[0]:arguments,a.forEach(b,function(a){c.add(a)}),c.run(),c.promise}),r(a,{parseNS:c,dwrap:P,set:d,get:f,del:e,exists:h,register:i,check:j,find:l,install:m,makeQuark:Q,ensure:R,decode:S,request:U,translate:T,inject:V,plugin:k,loop:L,each:M,iterate:N,forEach:O,isBoolean:E,isDefined:z,isUndefined:y,isArray:G,isArrayLike:F,isObject:D,isFunction:C,isNumber:B,isString:A,isInjectable:K,isEmpty:I,isQuark:H,instantiate:n,map:o,object:{mask:q,extend:r,copy:v,equals:w,merge:s,override:t},string:{trim:X},array:{compare:ab,indexOf:Y,remove:Z,removeAll:$,filter:_,override:u},error:{report:x},url:{resolve:W}})}(this),a.inject(["bmoor.defer.Basic",function(b){"use strict";var c,d=a.makeQuark("bmoor.build.Compiler"),e=function(){this.preProcess=[],this.postProcess=[],this.clean=!0},f={};e.make=function(c,d,e){var f,g=c.name,h=c.namespace,i=new b,j=i.promise;if(a.isObject(e))return f=e.abstract?function(){throw h+" is abstracted, either extend or use only static members"}:e.construct?e.construct:function(){},e.id=g,e.name=h.pop(),e.mount=a.get(h),e.namespace=h,e.whenDefined=d.$promise,this.clean||(this.preProcess.sort(function(a,b){return b.rank-a.rank}),this.postProcess.sort(function(a,b){return b.rank-a.rank}),this.clean=!0),i.resolve(),a.loop(this.preProcess,function(b){j=j.then(function(){return a.inject(b.module,e,f)})}),j.then(function(){return f.$onMake&&f.$onMake(e),f});throw"Constructor has no idea how to handle as definition of "+e},e.prototype.addModule=function(b,c,d){b=parseInt(b,10),this.clean=!1,arguments.length<3?d=c:a.install(c,d[d.length-1]),b>=0?this.preProcess.push({rank:b,module:d}):this.postProcess.push({rank:b,module:d})},e.prototype.make=function(c,d,g){var h,i,j=this,k=function(d){e.make.call(j,{name:c,namespace:h},i,d).then(function(c){var e=new b,f=e.promise;return e.resolve(),a.loop(j.postProcess,function(b){f=f.then(function(){var e=a.inject(b.module,d,c);return e.then(function(a){a&&(c=a)}),e})}),f.then(function(){return i.$ready(c),c})})};if(a.isString(c))h=a.parseNS(c);else{if(!a.isArray(c))throw JSON.stringify(c)+" > "+JSON.stringify(d)+" > message : you need to define a name and needs to be either a string or an array";h=c,c=c.join(".")}return i=a.makeQuark(h,g),a.isInjectable(d)||!function(){var a=d;d=[function(){return a}]}(),f[c]=d,a.require?a.require.inject(d,g).then(k):a.inject(d,g).then(k),i.$promise},e.prototype.mock=function(c,d,g){var h=this,i=new b,j={$promise:i.promise};return g||(g=a._root),a.inject(f[c],a.object.extend({},g,d),{},!0).then(function(c){return e.make.call(h,{name:"mock",namespace:["mock"]},j,c).then(function(d){var e=new b,f=e.promise;return e.resolve(),a.loop(h.postProcess,function(b){f=f.then(function(){return a.inject(b.module,c,d)})}),f.then(function(){return i.resolve(j),d})})})},e.prototype.define=function(b,c,d){var e=a.makeQuark(b,d);return a.isInjectable(c)?a.inject(c).then(function(a){e.$ready(a)}):e.$ready(c),e.$promise},c=new e,c.$constructor=e,a.plugin("make",function(a,b,d){return c.make(a,b,d)}),a.plugin("mock",function(b,d,e){return c.mock(b,a.map(d),e)}),a.plugin("define",function(a,b,d){return c.define(a,b,d)}),d.$ready(c)}]),a.inject(["bmoor.build.Compiler",function(b){"use strict";b.addModule(9,"bmoor.build.ModDecorate",["-decorators",function(b){var c=this.prototype;if(b){if(!a.isArray(b))throw"the decoration list must be an array";a.loop(b,function(a){a.$wrap&&a.$wrap(c)})}}])}]),a.inject(["bmoor.build.Compiler",function(b){"use strict";b.addModule(5,"bmoor.build.ModFactory",["-factory",function(b){var c=this;b&&a.iterate(b,function(a,b){c["$"+b]=function(){return a.apply(c,arguments)}})}])}]),a.inject(["bmoor.build.Compiler",function(a){"use strict";a.addModule(1,"bmoor.build.ModFinalize",["-onMake","-parent",function(a,b){a?this.$onMake=a:b&&(this.$onMake=b.$onMake)}])}]),a.inject(["bmoor.build.Compiler",function(b){"use strict";b.addModule(90,"bmoor.build.ModInherit",["-id","-namespace","-name","-mount","-parent",function(b,c,d,e,f){var g,h,i=this;f&&(g=a.isFunction(f)?f.prototype:f,h=function(){this.constructor=i},h.prototype=g,this.prototype=new h),this.prototype.$static=i,this.prototype.__class=b,this.prototype.__namespace=c,this.prototype.__name=d,this.prototype.__mount=e}])}]),a.inject(["bmoor.build.Compiler",function(b){"use strict";b.addModule(-1,"bmoor.build.ModInstances",["-instances",function(b){var c=this;b&&a.iterate(b,function(b,d){c["$"+d]=a.instantiate(c,b)})}])}]),a.inject(["bmoor.build.Compiler",function(b){"use strict";b.addModule(11,"bmoor.build.ModMixins",["-mixins",function(b){b&&(b=a.isArray(b)?b.splice(0):[b],b.unshift(this.prototype),a.object.extend.apply(this,b))}])}]),a.inject(["bmoor.build.Compiler",function(b){"use strict";b.addModule(-2,"bmoor.build.ModPlugin",["-plugins",function(b){var c=this;b&&a.loop(b,function(b){var d;d=b.instance?a.isString(b.instance)?c["$"+b.instance]:a.instantiate(c,b.instance):c,a.iterate(b.funcs,function(b,e){a.isString(b)&&(b=c[b]),a.plugin(e,function(){return b.apply(d,arguments)})})})}])}]),a.inject(["bmoor.build.Compiler",function(a){"use strict";a.addModule(10,"bmoor.build.ModProperties",["-properties",function(a){var b;for(b in a)this.prototype[b]=a[b]}])}]),a.inject(["bmoor.build.Compiler",function(b){"use strict";b.addModule(0,"bmoor.build.ModRegister",["-id",function(b){a.register(b,this)}])}]),function(){"use strict"}(),a.inject(["bmoor.build.Compiler",function(b){"use strict";b.addModule(-1,"bmoor.build.ModSingleton",["-singleton",function(b){var c,d=this;return b?(c=a.instantiate(d,[]),c.$constructor=d,c):void 0}])}]),a.inject(["bmoor.build.Compiler",function(b){"use strict";b.addModule(10,"bmoor.build.ModStatics",["-statics",function(b){var c=this;b&&a.iterate(b,function(a,b){c[b]=a})}])}]),a.inject(["bmoor.build.Compiler","-bmoor.comm.Http","bmoor.defer.Basic","bmoor.flow.Interval",function(b,c,d,e){"use strict";function f(b,c){function d(a){return c[a]||g.settings[a]}var f;return a.isString(c)&&(c={url:c}),f=function(){function j(a){var b=a.then(function(a){var b=q?q(a):a,c=b.data,d=b.code;return u&&u.call(p),r&&!r(d,c)?(Array.prototype.unshift.call(n,b),t.apply(p,n)):s?(Array.prototype.unshift.call(n,c),s.apply(p,n)):c},function(a){return u&&u.call(p),Array.prototype.unshift.call(n,a),t.apply(p,n)});return c.cached&&(h[l]=b),b}var k,l,m,n=arguments,o=d("http"),p=c.context||b,q=d("decode"),r=d("validation"),s=d("success"),t=d("failure"),u=d("always");return c.massage&&Array.prototype.push.call(n,c.massage.apply(p,n)),l="function"==typeof c.url?c.url.apply(p,n):c.url,m=c.preload?"function"==typeof c.preload?c.preload():c.preload:a.dwrap(void 0),m.then(function(){var b,d,m;if(c.response)d=function(){var b;return b="function"==typeof c.response?c.response.apply(p,n):c.response,j(b.then?b.then(function(a){return{data:a,code:200}}):a.dwrap({data:b,code:200}))};else{if(c.cached&&h[l])return h[l];if(i[l])return i[l];d=function(){return j(o(a.object.extend({method:c.method||"GET",data:n[n.length-1],url:l,headers:a.object.extend({"Content-Type":"application/json"},g.settings.headers,c.headers)},c.comm||{})))}}return void 0===c.interval||i[l]?b=d():(m=function(){return f.lastRun=(new Date).getTime(),d()},f.setInterval=function(a){var d=(new Date).getTime();b=!f.lastRun||d-a<f.lastRun||f.lastInterval&&f.lastInterval>a?m():l&&c.cached?h[l]:f.lastResponse,f.lastInterval=a,k&&e.clear(k),k=e.set(function(){i[l]=m()},a)},f.stopRefresh=function(){e.clear(k),c.onStopRefresh&&c.onStopRefresh.call(p)},c.interval?f.setInterval(c.interval):b=m()),l&&(i[l]=b,b.then(function(){i[l]=null},function(){i[l]=null})),f.lastResponse=b,b},function(){return Array.prototype.unshift.call(n,{code:0,message:"Preload Error"}),c.failure.apply(p,n)})}}var g,h={},i={};g=function(b){var c=this;a.iterate(b,function(a,b){c.prototype[b]=f(c,a)})},g.clearCache=function(a){delete h[a]},g.settings={http:c,defer:d,validation:function(a,b){return(!a||200===a)&&b},failure:function(a){console.log(a)}},b.addModule(9,"bmoor.build.ModStreams",["-streams",g])}]),a.make("bmoor.defer.Stack",[function(){"use strict";function a(a,b,c){return a.promise.then(function(){return b.apply({},c||[])})}return{construct:function(){this.promise=null},properties:{getPromise:function(){return this.promise},isStacked:function(){return null!==this.promise},begin:function(){this.promise=null},run:function(a){this.promise?this.promise["finally"](a):a()},add:function(b,c){return this.promise?this.promise=a(this,b,c):(this.promise=b.apply({},c),this.promise.then||(this.promise=null)),this.promise}}}}]),a.make("bmoor.flow.Batch",["bmoor.flow.Timeout",function(b){"use strict";return{construct:function(){this.content=null,this.timeoutId=null,this.notices=[]},properties:{wrap:function(a){var b=this;return function(){b.set(a.apply(this,arguments))}},set:function(b){this.registerCall(),this.content=a.object.merge(this.content,b)},notice:function(a){this.notices.push(a)},registerCall:function(){var a=this,c=this.notices;b.clear(this.timeoutId),this.timeoutId=b.set(function(){var b,d,e=a.content;for(a.content=null,b=0,d=c.length;d>b;b++)c[b](e)},30)}}}}]),a.make("bmoor.flow.Interval",[function(){"use strict";return{construct:function(){this.clearAll()},properties:{set:function(b,c){var d,e=this.timeouts[c],f=this._c++;return e||(e=this.timeouts[c]={_c:0},a.testMode||(e._hk=setInterval(function(){a.iterate(e,function(a){a()})},c))),d=e._c++,e[d]=b,this.hash[f]={hk:e._c,val:c},f},flush:function(){a.iterate(this.timeouts,function(b){a.iterate(b,function(a){a()})})},clear:function(a){var b=this.hash[a];b&&(delete this.timeouts[b.val][b.hk],delete this.hash[a])},clearAll:function(){this._c=0,this.timeouts={},this.hash={}}},singleton:!0}}]),a.make("bmoor.flow.Regulator",["bmoor.flow.Timeout",function(b){"use strict";return{construct:function(){this.content=null,this.timeoutId=null,this.notices=[]},properties:{wrap:function(a){var b=this;return function(){b.set(a.apply(this,arguments))}},set:function(b){this.registerCall(),this.content=a.object.merge(this.content,b)},notice:function(a){this.notices.push(a)},registerCall:function(){var a=this,c=this.notices;this.timeoutId||(this.timeoutId=b.set(function(){var b,d,e=a.content;for(a.content=null,this.timeoutId=null,b=0,d=c.length;d>b;b++)c[b](e)},30))}}}}]),a.make("bmoor.flow.Timeout",[function(){"use strict";return{construct:function(){},properties:{set:function(a,b){return setTimeout(a,b)},clear:function(a){clearTimeout(a)}},singleton:!0}}]),a.make("bmoor.core.Decorator",[function(){"use strict";function b(b,c,d){var e=typeof d,f=c[b];a.isFunction(e)?c[b]=function(){var a,b=this._wrapped;return this.$wrapped=f,a=d.apply(this,arguments),this.$wrapped=b,a}:a.isString(e)&&(c[b]+=" "+d)}return{construct:function(){},onMake:function(){var a=this,c=new a;a.$wrap=function(a){var d;for(d in c)"_construct"!==d&&(a[d]?b(d,a,c[d]):a[d]=c[d])}}}}]),a.make("bmoor.data.Collection",["bmoor.data.Model",function(a){"use strict";return{mixins:[a],construct:function(a){var b,c=[];for(b in this)c[b]=this[b];return c.override(c.inflate(a)),c},properties:{simplify:function(){return this.deflate().slice(0)}}}}]),a.make("bmoor.data.CollectionObserver",["bmoor.data.MapObserver",function(b){"use strict";return{parent:b,construct:function(){b.apply(this,arguments)},properties:{observe:function(c){var d,e,f;for(this._old=[],this.watches=[],d=0,e=c.length;e>d;d++)f=c[d],a.isString(f)&&(f=new String(f)),this._old[d]=c[d]=f;b.prototype.observe.call(this,c)},watchChanges:function(a){this.watches.push(a)},check:function(){var c=this;this.active&&!this.checking&&(b.prototype.check.call(this),this.checking=!0,this.changes=this.checkChanges(),this._needNotify(this.changes)&&a.loop(this.watches,function(a){a(c.changes)}),this.checking=!1)},checkChanges:function(){var b,c,d,e=this.model,f=this._old,g={},h={},i={};for(b=0,c=f.length;c>b;b++)f[b]._pos=b,i[b]=f[b];for(b=0,c=e.length;c>b;b++)d=e[b],void 0===d._pos?g[b]=e[b]:(delete i[d._pos],d._pos!==b&&(h[b]=d._pos));f.length=e.length;for(b in g)d=g[b],a.isString(d)&&(d=new String(d),g[b]=e[b]=d),f[b]=d;for(b=0,c=e.length;c>b;b++)delete e[b]._pos,f[b]=e[b];return{moves:h,inserts:g,removals:i}},_needNotify:function(b){return!a.isEmpty(b.moves)||!a.isEmpty(b.inserts)||!a.isEmpty(b.removals)}}}}]),a.make("bmoor.data.Map",["bmoor.data.Model",function(a){"use strict";return{mixins:[a],construct:function(a){this.override(this.inflate(a))}}}]),a.make("bmoor.data.MapObserver",["bmoor.flow.Interval",function(b){"use strict";var c=0;return{construct:function(a){var d=this,e=b;this.$snapMO=c++,this.checking=!1,this.watching={},this.observe(a),this.start(),e.set(function(){d.check()},30)},properties:{observe:function(a){this.model&&delete this.model.$observers[this.$snapMO],this.model=a,a.$observers||(a.$observers={}),a.$observers[this.$snapMO]=this},watch:function(a,b){var c,d;this.watching[a]||(c=a.split("."),this.watching[a]={path:c,value:this.evaluate(c),calls:[]}),d=this.watching[a],b(d.value,void 0),d.calls.push(b)},evaluate:function(b){var c,d,e=this.model;for(a.isString(b)&&(b=b.split(".")),c=0,d=b.length;d>c&&void 0!==e;c++)e=e[b[c]];return e},check:function(){var b=this;this.active&&!this.checking&&(this.checking=!0,a.iterate(this.watching,function(a){var c,d,e=b.evaluate(a.path);if(e!==a.value){for(c=0,d=a.calls.length;d>c;c++)a.calls[c](e,a.value);a.value=e}}),this.checking=!1)},start:function(){this.active=!0},stop:function(){this.active=!1}}}}]),a.define("bmoor.data.Model",[function(){"use strict";return{override:function(b){return a.isArrayLike(b)?a.array.override(this,b):a.object.override(this,b),this},validate:function(){return!0},inflate:function(a){return a},deflate:function(){return this.simplify()},update:function(b){return a.object.merge(this,b)},simplify:function(){var b={};return a.iterate(this,function(c,d){a.isFunction(c)||(b[d]=c)}),b},toJson:function(){return JSON.stringify(this.simplify())}}}]),a.make("bmoor.data.SmartMapObserver",["@undefined","bmoor.data.MapObserver",function(b,c){"use strict";function d(b,c,e){var f;if(a.isString(c))b.updates[c]=a.set(c,e,b.model);else if(a.isObject(c))for(f in c)c.hasOwnProperty(f)&&d(b,f,c[f])}function e(b,c){a.isString(c)&&(b.updates[c]=a.del(c,b.model))}return{parent:c,construct:function(){c.apply(this,arguments)},properties:{observe:function(a){var b=this;this.updates={},c.prototype.observe.call(this,a),a.$set=function(a,c){d(b,a,c)},a.$delete=function(a){e(b,a)}},check:function(){var b=this;a.iterate(this.updates,function(a,c){var d,e,f,g=b.watching[c];if(g)for(f=b.evaluate(c),d=0,e=g.calls.length;e>d;d++)g.calls[d](f,a)}),this.updates={}}}}}]),a.make("bmoor.error.Basic",["@undefined",function(a){"use strict";return{parent:Error,construct:function(b,c,d){var e,f;try{throw new Error}catch(g){f=g}this.name=this.__class,this.error=b,this.fileName=c,this.lineNumber=d,this.problem=a,f.stack&&(e=f.stack.split("\n"),"Error"===e[0]?(e.shift(),e.shift(),e.shift()):(e.pop(),e.shift(),e.shift()),this.problem=e[0],this.stack=e.join("\n")),this.message=b+"\n"+this.stack},properties:{toString:function(){return this.name+": "+this.message}}}}])}();