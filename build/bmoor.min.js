/*! bmoor 2014-07-08 */
!function(a){var b,c,d,e=this;try{b=global}catch(f){try{b=a}catch(f){b=e}}c=b.bMoor||{},d=b.bmoor||{},function(){"use strict";function a(a){return a?y(a)?a.split("."):E(a)?a.slice(0):a:[]}function e(c,d,e){var f,g,h,i=e||b;if(c&&(y(c)||D(c))){c=a(c),g=c.pop();for(var j=0;j<c.length;j++)h=c[j],i[h]||(i[h]={}),i=i[h];f=i[g],i[g]=d}return f}function f(c,d){var e,f,g,h=d||b;if(c&&(y(c)||D(c))){c=a(c),f=c.pop();for(var i=0;i<c.length;i++)g=c[i],h[g]||(h[g]={}),h=h[g];e=h[f],delete h[f]}return e}function g(c,d){var e,f=d||b;if(c&&(y(c)||D(c))){c=a(c);for(var g=0;g<c.length;g++)e=c[g],f[e]||(f[e]={}),f=f[e];return f}if(B(c))return c;throw"unsupported type"}function h(c,d){var e=d||b;if(y(c)||D(c)){c=a(c);for(var f=0;f<c.length;f++){var g=c[f];if(!e[g])return void 0;e=e[g]}return e}if(B(c))return c;throw"unsupported type"}function i(a,b){var c,d,e;if(D(b)){for(c=0,d=b.length;d>c&&!e;c++)e=h(a,b[c]);return e}return h(a,b)}function j(a,b,c){var d;c?(c.$aliases||(c.$aliases={}),d=c.$aliases):d=cb,d[a]=b}function k(a,b){var c;return b?(b.$aliases||(b.$aliases={}),c=b.$aliases):c=cb,c[a]}function l(a,b){e(a,b,c)}function m(a,b){var c;return void 0===b&&(c=k(E(a)?a.join("."):a))?c:i(a,b)}function n(a,b){e(a,b),j(a,b)}function o(a,b){var c,d,e;if(e="return new obj(",arguments.length>1)for(c=0,d=b.length;d>c;c++)c&&(e+=","),e+="args["+c+"]";return e+=")",new Function("obj","args",e)(a,b)}function p(a,b){return 1===arguments.length&&(b=a,a={}),L(b,function(b,c){e(c,b,a)}),a}function q(a){return Object.prototype.toString.call(a)}function r(a){var b=function(){};return b.prototype=a,o(b)}function s(a){return J(arguments,function(b){b!==a&&K(b,function(b,c){a[c]=b})}),a}function t(a,b,c){if(a===b)return b;if(b)if(b.copy)b.copy(a,c);else if(D(a)){b.length=0;for(var d=0,e=a.length;e>d;d++)b.push(t(a[d]))}else K(b,function(a,c){delete b[c]}),K(a,function(a,c){b[c]=a});else b=a,a&&(b=a.clone?a.clone():D(a)?t(a,[],c):t(a,{},c));return b}function u(a,b){var c,d,e,f=typeof a,g=typeof b;if(a===b)return!0;if(a!==a&&b!==b)return!0;if(null===a||void 0===a||null===b||null===b)return!1;if(a.equals)return a.equals(b);if(b.equals)return b.equals(a);if(f===g&&"object"===f)if(D(a)){if(!D(b))return!1;if((c=a.length)===b.length){for(d=0;c>d;d++)if(!u(a[d],b[d]))return!1;return!0}}else if(!D(b)){e={};for(d in a)if(a.hasOwnProperty(d)){if(!u(a[d],b[d]))return!1;e[d]=!0}for(d in b)if(b.hasOwnProperty(d)&&!e&&void 0!==b[d])return!1}return!1}function v(a){B(a)&&a.stack?(console.warn(a),console.debug(a.stack)):(console.warn(a),console.trace())}function w(a){return void 0===a}function x(a){return void 0!==a}function y(a){return"string"==typeof a}function z(a){return"number"==typeof a}function A(a){return"function"==typeof a}function B(a){return a&&"object"==typeof a}function C(a){return"boolean"==typeof a}function D(a){return a?"number"==typeof a.length:!1}function E(a){return"[object Array]"===q(a)}function F(a){return"function"==typeof a&&a.$isQuark}function G(a){var b;if(!B(a))return D(a)?0===a.length:w(a);for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function H(a){return B(a)&&void 0!==a.then}function I(a){return E(a)&&A(a[a.length-1])}function J(a,b,c){var d,e;for(c||(c=a),d=0,e=a.length;e>d;++d)d in a&&b.call(c,a[d],d,a)}function K(a,b,c){var d;c||(c=a);for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)}function L(a,b,c){var d;c||(c=a);for(d in a)a.hasOwnProperty(d)&&"_"!==d.charAt(0)&&"prototype"!==d&&"length"!==d&&"name"!==d&&b.call(c,a[d],d,a)}function M(a,b,c){a&&(a.forEach&&a.forEach!==M?a.forEach(b,c):D(a)?J(a,b,c):A(a)?L(a,b,c):K(a,b,c))}function N(a){var b;return F(a)?a.$promise:(b=new _,b.resolve(a),b.promise)}function O(c,d){var f,g=a(c),h=i(g),j=function(){};return F(h)?h:(d=d||b,j.$isQuark=!0,_&&(f=new _,j.$promise=f.promise,j.$ready=function(a){f.resolve&&f.resolve(a),g&&e(g,a,d)}),e(g,j,d),j)}function P(a,b){var c=i(a,b);return c?N(c):O(a,b).$promise}function Q(a,b){var c,d=[];return J(a,function(a,e){y(a)?(c=a.charAt(0),"@"===c?d[e]=k(a.substr(1),b):"-"===c?d[e]=i(a.substr(1),b):("+"===c&&(a=a.substr(1)),d[e]=P(a,b))):d[e]=a}),d}function R(a,b,c){var d;return y(a)?P(a,c):D(a)?(d=new ab,J(a,function(e,f){b&&y(e)&&(e=P(e,c)),H(e)?(e.then(function(b){a[f]=b}),d.add(e)):a[f]=e}),d.run(),d.promise.then(function(){return a})):void 0}function S(a,b,d){var e;if(A(a))e=a,a=[];else{if(!I(a))throw"inject needs arr to be either Injectable or Function";e=a[a.length-1]}return d||(d=c),R(Q(a,b),!1,b).then(function(a){return e.apply(d,a)})}function T(a){var b=a,c=document.createElement("a");return bb&&(c.setAttribute("href",b),b=c.href),c.setAttribute("href",b),{href:c.href,protocol:c.protocol?c.protocol.replace(/:$/,""):"",host:c.host,search:c.search?c.search.replace(/^\?/,""):"",hash:c.hash?c.hash.replace(/^#/,""):"",hostname:c.hostname,port:c.port,pathname:"/"===c.pathname.charAt(0)?c.pathname:"/"+c.pathname}}function U(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function V(a,b,c){if(a.indexOf)return a.indexOf(b,c);var d=parseInt(a.length,0);for(c=+c||0,1/0===Math.abs(c)&&(c=0),0>c&&(c+=d,0>c&&(c=0));d>c;c++)if(a[c]===b)return c;return-1}function W(a,b,c){var d=V(a,b,c);return d>-1?[a.splice(d,1)]:[]}function X(a,b,c){var d,e,f=V(a,b,c);return f>-1?(e=a.splice(f,1),d=X(a,b,f),d.unshift(e),d):[]}function Y(a,b,c){if(a.filter)return a.filter(b,c);var d,e,f=Object(this),g=parseInt(f.length,10),h=[];if(!A(b))throw"func needs to be a function";for(d=0;g>d;d++)d in f&&(e=f[d],b.call(c,e,d,f)&&h.push(e));return h}function Z(a,b,c){var d,e=[],f=[],g=[],h=[];for(a=a.slice(0),b=b.slice(0),a.sort(c),b.sort(c);a.length>0&&b.length>0;)d=c(a[0],b[0]),0>d?e.push(a.shift()):d>0?f.push(b.shift()):(g.push(a.shift()),h.push(b.shift()));for(;a.length;)e.push(a.shift());for(;b.length;)f.push(b.shift());return{left:e,intersection:{left:g,right:h},right:f}}function $(a){this.defer=a}function _(a){this.handler=a||this.defaultHandler,this.callbacks=[],this.value=null,this.promise=new $(this)}function ab(){this.count=0,this.loaded=!1,this.errors=[],this.defer=new _,this.promise=this.defer.promise}var bb,cb={};b.navigator?(bb=parseInt((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1],10),isNaN(bb)&&(bb=parseInt((/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1],10)),c.env={browser:!0,msie:bb}):(c.env={browser:!1},module.exports=c),j("global",b),j("undefined",void 0),e("bMoor",c),e("bmoor",d),e("bmoor.defer.Promise",$),s($.prototype,{then:function(a,b){var c,d,e=this,f=this.defer,g=this.sub=this.defer.sub();return c=function(b){try{g.resolve((a||f.defaultSuccess)(b)),e.sub=null}catch(c){e.sub=null,g.reject(c),f.handler(c)}},d=function(a){try{g.resolve((b||f.defaultFailure)(a)),e.sub=null}catch(c){e.sub=null,g.reject(c),f.handler(c)}},f.register(c,d),g.promise},"catch":function(a){return this.then(null,a)},reject:function(a){if(!this.sub)throw"must reject from inside a then";this.sub.reject(a)},done:function(a){return this.then(a),this},fail:function(a){return this.then(null,a),this},"finally":function(a){function b(a,b){var c=d.defer.Basic();return b?c.resolve(a):c.reject(a),c.promise}function e(d,e){var g=null;try{g=(a||f.defaultSuccess)()}catch(h){return b(h,!1)}return g&&c.isFunction(g.then)?g.then(function(){return b(d,e)},function(a){return b(a,!1)}):b(d,e)}var f=this;return this.then(function(a){return e(a,!0)},function(a){return e(a,!1)})},always:function(a){return this["finally"](a),this}}),e("bmoor.defer.Basic",_),function(){function a(a){return a&&a.then?a:{then:function(b){c.isArrayLike(a)&&a.$inject?b.apply(void 0,a):b(a)}}}function b(a){return{then:function(b,c){c(a)}}}s(_.prototype,{defaultHandler:function(a){c.error.report(a)},defaultSuccess:function(a){return a},defaultFailure:function(a){throw a},register:function(a,b){this.value?this.value.then(a,b):this.callbacks.push([a,b])},resolve:function(b){var c,d,e,f;if(this.callbacks)for(c=this.callbacks,this.callbacks=null,this.value=a(b),e=0,f=c.length;f>e;e++)d=c[e],this.value.then(d[0],d[1])},reject:function(a){this.resolve(b(a))},sub:function(){return new d.defer.Basic(this.handler)}})}(),e("bmoor.defer.Group",ab),function(){function a(a){0===a.count&&a.loaded&&(a.errors.length?a.defer.reject(a.errors):a.defer.resolve(!0))}function b(b){b.count--,a(b)}s(ab.prototype,{add:function(a){var c=this;this.count++,a.then(function(){b(c)},function(a){c.errors.push(a),b(c)})},run:function(){this.loaded=!0,a(this)}})}(),e("bmoor.defer.all",function(){var a,b=new ab;return a=z(arguments[0].length)?arguments[0]:arguments,c.forEach(a,function(a){b.add(a)}),b.run(),b.promise}),s(c,{parseNS:a,dwrap:N,set:e,get:g,del:f,exists:i,register:j,check:k,find:m,install:n,makeQuark:O,ensure:P,request:R,translate:Q,inject:S,plugin:l,loop:J,each:K,iterate:L,forEach:M,isBoolean:C,isDefined:x,isUndefined:w,isArray:E,isArrayLike:D,isObject:B,isFunction:A,isNumber:z,isString:y,isInjectable:I,isEmpty:G,isQuark:F,instantiate:o,map:p,object:{mask:r,extend:s,copy:t,equals:u},string:{trim:U},array:{compare:Z,indexOf:V,remove:W,removeAll:X,filter:Y},error:{report:v},url:{resolve:T}}),b.require||(b.require=function(){return c})}(),c.inject(["bmoor.defer.Basic","@global",function(a,b){"use strict";var d,e=c.makeQuark("bmoor.build.Compiler"),f=function(){this.preProcess=[],this.postProcess=[],this.clean=!0},g={};f.make=function(b,d,e){var f,g=b.name,h=b.namespace,i=new a,j=i.promise;if(c.isObject(e))return f=e.abstract?function(){throw h+" is abstracted, either extend or use only static members"}:e.construct?e.construct:function(){},e.id=g,e.name=h.pop(),e.mount=c.get(h),e.namespace=h,e.whenDefined=d.$promise,this.clean||(this.preProcess.sort(function(a,b){return b.rank-a.rank}),this.postProcess.sort(function(a,b){return b.rank-a.rank}),this.clean=!0),i.resolve(),c.loop(this.preProcess,function(a){j=j.then(function(){return c.inject(a.module,e,f)})}),j.then(function(){return f.$onMake&&f.$onMake(e),f});throw"Constructor has no idea how to handle as definition of "+e},f.prototype.addModule=function(a,b,d){a=parseInt(a,10),this.clean=!1,arguments.length<3?d=b:c.install(b,d[d.length-1]),a>=0?this.preProcess.push({rank:a,module:d}):this.postProcess.push({rank:a,module:d})},f.prototype.make=function(b,d,e){var h,i,j=this,k=function(d){f.make.call(j,{name:b,namespace:h},i,d).then(function(b){var e=new a,f=e.promise;return e.resolve(),c.loop(j.postProcess,function(a){f=f.then(function(){return c.inject(a.module,d,b)})}),f.then(function(){return i.$ready(b),b})})};if(c.isString(b))h=c.parseNS(b);else{if(!c.isArray(b))throw JSON.stringify(b)+" > "+JSON.stringify(d)+" > message : you need to define a name and needs to be either a string or an array";h=b,b=b.join(".")}return i=c.makeQuark(h,e),c.isInjectable(d)||!function(){var a=d;d=[function(){return a}]}(),g[b]=d,c.require?c.require.inject(d,e).then(k):c.inject(d,e).then(k),i.$promise},f.prototype.mock=function(d,e,h){var i=this,j=new a,k={$promise:j.promise};return h||(h=b),c.inject(g[d],c.object.extend({},h,e)).then(function(b){return f.make.call(i,{name:"mock",namespace:["mock"]},k,b).then(function(d){var e=new a,f=e.promise;return e.resolve(),c.loop(i.postProcess,function(a){f=f.then(function(){return c.inject(a.module,b,d)})}),f.then(function(){return j.resolve(k),d})})})},f.prototype.define=function(a,b,d){var e=c.makeQuark(a,d);return c.isInjectable(b)?c.inject(b).then(function(a){e.$ready(a)}):e.$ready(b),e.$promise},d=new f,f.$instance=d,c.install("bmoor.build.$compiler",d),c.plugin("make",function(a,b){return d.make(a,b)}),c.plugin("mock",function(a,b){return d.mock(a,c.map(b))}),c.plugin("define",function(a,b){return d.define(a,b)}),e.$ready(f)}]),c.inject(["bmoor.build.Compiler",function(a){"use strict";a.$instance.addModule(9,"bmoor.build.ModDecorate",["-decorators",function(a){var b=this.prototype;if(a){if(!c.isArray(a))throw"the decoration list must be an array";c.loop(a,function(a){a.$wrap&&a.$wrap(b)})}}])}]),c.inject(["bmoor.build.Compiler",function(a){"use strict";a.$instance.addModule(5,"bmoor.build.ModFactory",["-factory",function(a){var b=this;a&&c.iterate(a,function(a,c){b["$"+c]=function(){return a.apply(b,arguments)}})}])}]),c.inject(["bmoor.build.Compiler",function(a){"use strict";a.$instance.addModule(1,"bmoor.build.ModFinalize",["-onMake","-parent",function(a,b){a?this.$onMake=a:b&&(this.$onMake=b.$onMake)}])}]),c.inject(["bmoor.build.Compiler",function(a){"use strict";a.$instance.addModule(90,"bmoor.build.ModInherit",["-id","-namespace","-name","-mount","-parent",function(a,b,c,d,e){var f,g=this;e&&(f=function(){this.constructor=g},f.prototype=e.prototype,this.prototype=new f),this.prototype.$static=g,this.prototype.__class=a,this.prototype.__namespace=b,this.prototype.__name=c,this.prototype.__mount=d}])}]),c.inject(["bmoor.build.Compiler",function(a){"use strict";a.$instance.addModule(8,"bmoor.build.ModMixins",["-mixins",function(a){a&&(a=c.isArray(a)?a.splice(0):[a],a.unshift(this.prototype),c.object.extend.apply(this,a))}])}]),c.inject(["bmoor.build.Compiler",function(a){"use strict";a.$instance.addModule(-2,"bmoor.build.ModPlugin",["-plugins",function(a){var b=this;a&&c.loop(a,function(a){var d;d=a.instance?c.isString(a.instance)?b["$"+a.instance]:c.instantiate(b,a.instance):b,c.iterate(a.funcs,function(a,e){c.isString(a)&&(a=b[a]),c.plugin(e,function(){return a.apply(d,arguments)})})})}])}]),c.inject(["bmoor.build.Compiler",function(a){"use strict";a.$instance.addModule(10,"bmoor.build.ModProperties",["-properties",function(a){var b;for(b in a)this.prototype[b]=a[b]}])}]),c.inject(["bmoor.build.Compiler",function(a){"use strict";a.$instance.addModule(0,"bmoor.build.ModRegister",["-id",function(a){c.register(a,this)}])}]),function(){"use strict"}(),c.inject(["bmoor.build.Compiler",function(a){"use strict";a.$instance.addModule(-1,"bmoor.build.ModSingleton",["-singleton",function(a){var b=this;a&&c.iterate(a,function(a,d){b["$"+d]=c.instantiate(b,a)})}])}]),c.inject(["bmoor.build.Compiler",function(a){"use strict";a.$instance.addModule(10,"bmoor.build.ModStatics",["-statics",function(a){var b=this;a&&c.iterate(a,function(a,c){b[c]=a})}])}]),c.make("bmoor.defer.Stack",[function(){"use strict";function a(a,b,c){return a.promise.then(function(){return b.apply({},c||[])})}return{construct:function(){this.promise=null},properties:{getPromise:function(){return this.promise},isStacked:function(){return null!==this.promise},begin:function(){this.promise=null},run:function(a){this.promise?this.promise["finally"](a):a()},add:function(b,c){return this.promise?this.promise=a(this,b,c):(this.promise=b.apply({},c),this.promise.then||(this.promise=null)),this.promise}}}}]),c.make("bmoor.core.Interval",[function(){"use strict";return{singleton:{instance:[]},construct:function(){this._c=0,this.timeouts={},this.hash={}},properties:{set:function(a,b){var d,e=this.timeouts[b],f=this._c++;return e||(e=this.timeouts[b]={_c:0},c.testMode||(e._hk=setInterval(function(){c.iterate(e,function(a){a()})},b))),d=e._c++,e[d]=a,this.hash[f]={hk:e._c,val:b},f},flush:function(){c.iterate(this.timeouts,function(a){c.iterate(a,function(a){a()})})},clear:function(a){var b=this.hash[a];b&&(delete this.timeouts[b.val][b.hk],delete this.hash[a])}},plugins:[{instance:"instance",funcs:{setInterval:"set",clearInterval:"clear"}}]}}]),c.make("bmoor.core.Decorator",[function(){"use strict";function a(a,b,d){var e=typeof d,f=b[a];c.isFunction(e)?b[a]=function(){var a,b=this._wrapped;return this.$wrapped=f,a=d.apply(this,arguments),this.$wrapped=b,a}:c.isString(e)&&(b[a]+=" "+d)}return{construct:function(){},onMake:function(){var b=this,c=new b;b.$wrap=function(b){var d;for(d in c)"_construct"!==d&&(b[d]?a(d,b,c[d]):b[d]=c[d])}}}}]),c.make("bmoor.data.Collection",["bmoor.data.Model",function(a){"use strict";return{parent:Array,traits:[a],construct:function(a){this.merge(this.inflate(a))},properties:{simplify:function(){return this.deflate().slice(0)}}}}]),c.make("bmoor.data.CollectionObserver",["bmoor.data.MapObserver",function(a){"use strict";return{parent:a,construct:function(){a.apply(this,arguments)},properties:{observe:function(b){var c=this;this.removals=[],this.watches=[],this.changes={moves:[],removals:[]},b.pop=function(){var a=Array.prototype.pop.call(this);return void 0===a.$markRemoval&&(a.$markRemoval=c.removals.length),c.removals.push(a),a},b.shift=function(){var a=Array.prototype.shift.call(this);return void 0===a.$markRemoval&&(a.$markRemoval=c.removals.length),c.removals.push(a),a},b.splice=function(){var a,b,d=Array.prototype.splice.apply(this,arguments);for(a=0,b=d.length;b>a;a++)void 0===d[a].$markRemoval&&(d[a].$markRemoval=c.removals.length+a);return c.removals=c.removals.concat(d),d},a.prototype.observe.call(this,b)},watchChanges:function(a){this.watches.push(a)},check:function(){var b=this;this.checking||(a.prototype.check.call(this),this.checking=!0,this.changes=this.checkChanges(),this._needNotify(this.changes)&&c.loop(this.watches,function(a){a(b.changes)}),this.checking=!1)},checkChanges:function(){var a,b,d,e=this.model,f={},g={};for(d in e)if(e.hasOwnProperty(d)&&"_"!==d[0]){if(b=e[d],c.isFunction(b))continue;a=parseInt(d,10),isNaN(a)||(b._co||(b._co={}),b.$remove?this.model.splice(a,1):void 0===b._co.index?g[d]=b:b._co.index!==a&&(g[d]=b,void 0!==b.$markRemoval&&(this.removals[b.$markRemoval]=void 0,delete b.$markRemoval)),b._co.index=a)}return f.removals=this.removals,f.moves=g,this.removals=[],f},_needNotify:function(a){var b;for(b in a)if(a.hasOwnProperty(b))if("removals"===b){if(a.removals.length)return!0}else{if("moves"!==b)return!0;if(!c.isEmpty(a.moves))return!0}return!1}}}}]),c.make("bmoor.data.Map",["bmoor.data.Model",function(a){"use strict";return{traits:[a],construct:function(a){this._merge(this._inflate(a))},properties:{_simplify:function(){var a,b={},c=this.deflate();for(a in c)c.hasOwnProperty(a)&&"$"!==a.charAt(0)&&(b[a]=c[a]);return b},toJson:function(){return JSON.stringify(this._simplify())}}}}]),c.make("bmoor.data.MapObserver",["bmoor.flow.Interval",function(a){"use strict";var b=0,d={};return{construct:function(e){0===b&&a.$instance.set(function(){c.iterate(d,function(a){a.check()})},30),this.$snapMO=b++,this.checking=!1,this.watching={},this.observe(e),this.start()},properties:{observe:function(a){this.model&&delete this.model.$observers[this.$snapMO],this.model=a,a.$observers||(a.$observers={}),a.$observers[this.$snapMO]=this},watch:function(a,b){var c,d;this.watching[a]||(c=a.split("."),this.watching[a]={path:c,value:this.evaluate(c),calls:[]}),d=this.watching[a],b(d.value,void 0),d.calls.push(b)},evaluate:function(a){var b,d,e=this.model;for(c.isString(a)&&(a=a.split(".")),b=0,d=a.length;d>b&&void 0!==e;b++)e=e[a[b]];return e},check:function(){var a=this;this.checking=!0,c.iterate(this.watching,function(b){var c,d,e=a.evaluate(b.path);if(e!==b.value){for(c=0,d=b.calls.length;d>c;c++)b.calls[c](e,b.value);b.value=e}}),this.checking=!1},start:function(){d[this.$snapMO]=this},stop:function(){delete d[this.$snapMO]}}}}]),c.define("bmoor.data.Model",[function(){"use strict";function a(d,e){var f,g,h;for(f in d)d.hasOwnProperty(f)&&(g=d[f],h=e[f],void 0===h?e[f]=g:c.isArrayLike(g)?(c.isArrayLike(h)||(h=e[f]=[]),b(g,h)):c.isObject(g)?(c.isObject(h)||(h=e[f]={}),a(g,h)):g!==h&&(e[f]=g));for(f in e)e.hasOwnProperty(f)&&void 0===d[f]&&delete e[f];return e}function b(d,e){var f,g,h,i;for(f=0,g=d.length;g>f;f++)h=d[f],i=e[f],void 0===i?e[f]=h:c.isArrayLike(h)?(c.isArrayLike(i)||(i=e[f]=[]),b(h,i)):c.isObject(h)?(c.isObject(i)||(i=e[f]={}),a(h,i)):h!==i&&(e[f]=h);for(f=g,g=e.length;g>f;f++)e.pop()}return{_merge:function(d){return c.isArray(d)?b(d,this):a(d,this),this},_validate:function(){return null},_inflate:function(a){return a},_deflate:function(){return this},_update:function(a){this._merge(a,this)},_simplify:function(){return this._deflate()},toJson:function(){return JSON.stringify(this._simplify())}}}]),c.make("bmoor.data.SmartMapObserver",["@undefined","bmoor.data.MapObserver",function(a,b){"use strict";function d(a,b,e){var f;if(c.isString(b))a.updates[b]=c.set(b,e,a.model);else if(c.isObject(b))for(f in b)b.hasOwnProperty(f)&&d(a,f,b[f])}function e(a,b){c.isString(b)&&(a.updates[b]=c.del(b,a.model))}return{parent:b,construct:function(){b.apply(this,arguments)},properties:{observe:function(a){var c=this;this.updates={},b.prototype.observe.call(this,a),a.$set=function(){d.apply(c,arguments)},a.$delete=function(){e.apply(c,arguments)}},check:function(){var a=this;c.iterate(this.updates,function(b,c){var d,e,f,g=a.watching[c];if(g)for(f=a.evaluate(c),d=0,e=g.calls.length;e>d;d++)g.calls[d](f,b)}),this.updates={}}}}}]),c.make("bmoor.error.Basic",["@undefined",function(a){"use strict";return{parent:Error,construct:function(b,c,d){var e,f;try{throw new Error}catch(g){f=g}this.name=this.__class,this.error=b,this.fileName=c,this.lineNumber=d,this.problem=a,f.stack&&(e=f.stack.split("\n"),"Error"===e[0]?(e.shift(),e.shift(),e.shift()):(e.pop(),e.shift(),e.shift()),this.problem=e[0],this.stack=e.join("\n")),this.message=b+"\n"+this.stack},properties:{toString:function(){return this.name+": "+this.message}}}}])}(this);