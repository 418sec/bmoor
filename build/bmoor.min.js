/*! bmoor 2014-01-14 */
!function(a,b){"use strict";function c(a){return a?r(a)?a.split("."):w(a)?a.slice(0):a:[]}function d(b,d,e){var f,g=e||a;if(b&&(r(b)||v(b))){b=c(b);for(var h=0;h<b.length;h++)f=b[h],h===b.length-1?g[f]=d:(g[f]||(g[f]={}),g=g[f])}}function e(b,d){var e,f=d||a;if(b&&(r(b)||v(b))){b=c(b);for(var g=0;g<b.length;g++)e=b[g],f[e]||(f[e]={}),f=f[e];return f}return u(b)?b:null}function f(b,d){var e=d||a;if(r(b)||v(b)){b=c(b);for(var f=0;f<b.length;f++){var g=b[f];if(!e[g])return null;e=e[g]}return e}return u(b)?b:null}function g(a,b){P[a]=b}function h(a){return P[a]}function i(a,c){var d;return c===b&&(d=h(w(a)?a.join("."):a))?d:f(a,c)}function j(a,b){d(a,b),g(a,b)}function k(a){console.log(a)}function l(a){return Object.prototype.toString.call(a)}function m(a){var b=new L;return b.resolve(a),b.promise}function n(a,b){return i(a,b)}function o(a,b){return m(n(a,b))}function p(a){return a===b}function q(a){return a!==b}function r(a){return"string"==typeof a}function s(a){return"number"==typeof a}function t(a){return"function"==typeof a}function u(a){return a&&"object"==typeof a}function v(a){return a&&"number"==typeof a.length&&(1!=a.length||a[0])}function w(a){return a&&"[object Array]"===l(a)}function x(a){a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function y(a,b,c){var d,e;for(c||(c=a),d=0,e=a.length;e>d;++d)d in a&&b.call(c,a[d],d,a)}function z(a,b,c){var d;c||(c=a);for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)}function A(a,b,c){var d;c||(c=a);for(d in a)"prototype"!==d&&"length"!==d&&"name"!==d&&a.hasOwnProperty(d)&&b.call(c,a[d],d,a)}function B(a,b,c){a.forEach&&a.forEach!==B?a.forEach(b,c):v(a)?y(a,b,c):t(a)?A(a,b,c):z(a,b,c)}function C(a){if(Object.create)return Object.create(a);var b=function(){};if(1!==arguments.length)throw new Error("create implementation only accepts one parameter.");return b.prototype=a,new b}function D(a){return y(arguments,function(b){b!==a&&z(b,function(b,c){a[c]=b})}),a}function E(a,b,c){if(a===b)return b;if(b)if(b.copy)b.copy(a);else if(v(a)){b.length=0;for(var d=0,e=a.length;e>d;d++)b.push(E(a[d]))}else z(b,function(a,c){delete b[c]}),z(a,function(a,c){b[c]=a});else b=a,a&&(b=a.clone?a.clone():v(a)?E(a,[],c):E(a,{},c));return b}function F(a,c){var d,e,f,g=typeof a,h=typeof c;if(a===c)return!0;if(a!==a&&c!==c)return!0;if(null===a||a===b||null===c||null===c)return!1;if(a.equals)return a.equals(c);if(c.equals)return c.equals(a);if(g===h&&"object"===g)if(v(a)){if(!v(c))return!1;if((d=a.length)===c.length){for(e=0;d>e;e++)if(!F(a[e],c[e]))return!1;return!0}}else if(!v(c)){f={};for(e in a)if(a.hasOwnProperty(e)){if(!F(a[e],c[e]))return!1;f[e]=!0}for(e in c)if(c.hasOwnProperty(e)&&!f&&c[e]!==b)return!1}return!1}function G(a,b,c){var d,e=[];return b?(d=new M,y(a,function(a,b){d.add(o(a,c).then(function(a){e[b]=a}))}),d.run(),d.promise.then(function(){return e},function(a){throw k("translation failure",a),"unable to request for translation"})):(y(a,function(a,b){e[b]=f(a,c)}),e)}function H(a,b,c,d){var e,f;if(t(a))e=a,a=[];else{if(!w(a))throw"inject needs arr to be either Array or Function";e=a.pop()}return f=G(a,b,d),a.push(e),b?f.then(function(a){return e.apply(c,a)},function(a){k("injection error",a)}):e.apply(c,f)}function I(a,b){d(a,b,N)}function J(a,b){function c(a){this._construct&&c.$construct&&(a&&a.$arguments?this._construct.apply(this,a):this._construct.apply(this,arguments))}return b&&(c.$defer=new L),c.$construct=!0,d(a,c),c}function K(a,b){var c;return c=i(a),c?c:J(a,!b)}var L,M,N=a.bMoor||{},O=a.bmoor||{},P={};D(N,{parse:c,set:d,get:e,exists:f,register:g,check:h,find:i,install:j,require:n,request:o,translate:G,inject:H,plugin:I,makeQuark:J,ensure:K,create:C,extend:D,copy:E,equals:F,loop:y,each:z,iterate:A,forEach:B,isDefined:q,isUndefined:p,isArray:w,isArrayLike:v,isObject:u,isFunction:t,isNumber:s,isString:r,trim:x,error:k}),d("bMoor",N),d("bmoor",O),L=K("bmoor.defer.Basic",!0),M=K("bmoor.defer.Group",!0),L.prototype.resolve=function(){},L.prototype.promise={then:function(a){return a(),L.prototype.promise}}}(this),function(a){function b(){this.stack=[],this.clean=!0}var c,d=a.ensure("bmoor.defer.Basic");b.prototype.addModule=function(b,c,d){this.clean=!1,arguments.length<3?d=c:a.install(c,d[d.length-1]),this.stack.push({rank:parseInt(b,10),module:d})},b.prototype.make=function(b){var c,e=new d,f=e.promise;if(a.isString(b.name))b.id=b.name,b.namespace=a.parse(b.name);else{if(!a.isArray(b.name))throw"you need to define a name and needs to be either a string or an array";b.namespace=b.name,b.id=b.name.join(".")}return c=a.ensure(b.id),b.name=b.namespace.pop(),b.mount=a.get(b.namespace),this.clean||(this.stack.sort(function(a,b){return b.rank-a.rank}),this.clean=!0),e.resolve(c),a.loop(this.stack,function(d){f=f.then(function(){a.inject(d.module,!1,c,b)})}),f.then(function(){return c.prototype.__postMake&&c.prototype.__postMake(c),c.$defer&&(c.$defer.resolve(!0),delete c.$defer),c})},c=new b,a.install("bmoor.build.Compiler",b),a.plugin(["compiler"],c),a.plugin(["define"],function(a){return c.make(a)})}(bMoor),function(a){a.addModule(20,"bmoor.build.ModConstruct",["construct","id",function(a){a&&(this.prototype._construct=a)}])}(bMoor.compiler),function(a){a.addModule(9,"bmoor.build.Decorate",["decorators",function(a){var b=this.prototype;if(a){if(!bMoor.isArray(a))throw"the decoration list must be an array";return bMoor.translate(a,!0).then(function(a){bMoor.loop(a,function(a){a.$singleton&&a.$singleton.$decorate(b)})})}}])}(bMoor.compiler),function(a){a.addModule(5,"bmoor.build.ModFactory",["factory","mount",function(a,b){var c=this;a&&(b[a]=function(){var a=arguments;return a.$arguments=!0,new c(a)})}])}(bMoor.compiler),function(a,b){b.addModule(1,"bmoor.build.Finalize",["namespace","name","id","mount","postMake",function(a,b,c,d,e){var f,g=this,h=g.prototype;h.__namespace=a,h.__name=b,h.__class=c,h.__mount=d,e&&(h.__postMake?(f=h.__postMake,h.__postMake=function(){f(g),e&&e(g)}):h.__postMake=e)}])}(bMoor,bMoor.compiler),function(a,b){b.addModule(90,"bmoor.build.Inherit",["parent",function(b){b=a.find(b),b&&(void 0!==b.$construct?(b.$construct=!1,this.prototype=new b,b.$construct=!0):this.prototype=new b,this.prototype.constructor=this,this.prototype[b.prototype.__class]=b.prototype)}])}(bMoor,bMoor.compiler),function(a,b){function c(a,b){var c;for(c in b)a.prototype[c]=b[c]}b.addModule(10,["properties",function(b){var d=this;return a.isArray(b)?a.inject(b,!0).then(function(a){c(d,a)}):(c(this,b),void 0)}])}(bMoor,bMoor.compiler),function(a,b){b.addModule(0,"bmoor.build.Register",["id",function(b){a.register(b,this)}])}(bMoor,bMoor.compiler),function(a){a.addModule(5,"bmoor.build.Singleton",["singleton","mount","name",function(a,b,c){var d=this;c=c.charAt(0).toLowerCase()+c.slice(1),a&&(bMoor.isArray(a)||(a=[]),a.$arguments=!0,d.$singleton=b[c]=new d(a))}])}(bMoor.compiler),function(){function a(a,b){var c,d,e=this,f=this.sub();return c=function(b){try{f.resolve((a||e.defaultSuccess)(b))}catch(c){f.reject(c),e.handler(c)}},d=function(a){try{f.resolve((b||e.defaultFailure)(a))}catch(c){f.reject(c),e.handler(c)}},this.value?this.value.then(c,d):this.callbacks.push([c,d]),f.promise}function b(a){return a&&a.then?a:{then:function(b){b(a)}}}function c(a){return{then:function(b,c){c(a)}}}bMoor.define({name:"bmoor.defer.Basic",construct:function(a){this.handler=a||this.defaultHandler,this.callbacks=[],this.value=null,this.init()},properties:{defaultHandler:function(a){bMoor.error(a)},defaultSuccess:function(a){return a},defaultFailure:function(){return void 0},init:function(){var b=this;this.promise={then:function(c,d){return a.call(b,c,d)}}},resolve:function(a){var c,d,e,f;if(this.callbacks)for(c=this.callbacks,this.callbacks=null,this.value=b(a),e=0,f=c.length;f>e;e++)d=c[e],this.value.then(d[0],d[1])},reject:function(a){this.resolve(c(a))},sub:function(){return new bmoor.defer.Basic(this.handler)}}})}(),function(){function a(){0===this.count&&this.loaded&&(this.errors.length?this.defer.reject(errors):this.defer.resolve(!0))}function b(){this.count--,a.call(this)}bMoor.define({name:"bmoor.defer.Group",construct:function(){this.count=0,this.loaded=!1,this.errors=[],this.defer=new bmoor.defer.Basic,this.promise=this.defer.promise},properties:{add:function(a){var c=this;this.count++,a.then(function(){b.call(c)},function(a){c.errors.push(a),b.call(c)})},run:function(){this.loaded=!0,a.call(this)}}})}(),function(a){function b(a,b,c){var d=typeof c,e=b[a];"function"==d?b[a]=function(){var a,b=this._wrapped;return this.$wrapped=e,a=c.apply(this,arguments),this.$wrapped=b,a}:"string"==d&&(b[a]+=" "+c)}a.define({name:"bmoor.core.Decorator",require:["bmoor.build.Decorate"],postMake:function(a){a.$singleton=new a},properties:{$decorate:function(a){var c;for(c in this)"_construct"!==c&&"$decorate"!==c&&("__construct"===c?b("_construct",a,this[c]):a[c]?b(c,a,this[c]):a[c]=this[c])}}})}(this.bMoor);